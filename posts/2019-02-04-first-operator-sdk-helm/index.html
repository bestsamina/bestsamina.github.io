<!DOCTYPE html>
<html lang='en'><head>
  <title>ç¬¬ä¸€æ¬¡ç© operator-sdk å°±ä¸Šæ‰‹ - Samina Website</title>
  <link rel='canonical' href='https://bestsamina.github.io/posts/2019-02-04-first-operator-sdk-helm/' />
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1' />
  <meta name='description' content='' />
  <meta name='theme-color' content='#D250F4' />
  
    <link rel="shortcut icon" href="/images/favicon.jpg" type="image/x-icon" />
    <link rel="icon" href="/images/favicon.jpg" type="image/x-icon" />
  

  <meta name="generator" content="Hugo 0.97.3" />

  





<link rel="stylesheet" href="https://bestsamina.github.io/sass/style.min.dc7c04d679aa2c892fdb6d910a9f9d319b602240bc157288fb462e0e09d67c14.css" integrity="sha256-3HwE1nmqLIkv222RCp&#43;dMZtgIkC8FXKI&#43;0YuDgnWfBQ=" media="screen">
<link rel="stylesheet" href="https://bestsamina.github.io/syntax.min.css" integrity="" media="screen">

  <meta property="og:title" content="ç¬¬ä¸€æ¬¡ç© operator-sdk å°±ä¸Šæ‰‹" />
<meta property="og:description" content="æ–‡ç« è„ˆçµ¡  å‰è¨€ Operator Framework æ˜¯ä»€éº¼ èªè­˜ operator-sdk CLI å¯¦ä½œé–‹å§‹  å»ºç«‹ K8s ç’°å¢ƒ å®‰è£ operator-sdk CLI ç”¨ operator-sdk CLI å»ºç«‹ä¸€å€‹ operator äº†è§£ä¸€ä¸‹æ–°ç”¢ç”Ÿçš„ helm operator ä¸­çš„æª”æ¡ˆ ç·¨è¼¯æª”æ¡ˆ å…ˆåœ¨ K8s ä¸­ deploy CRD Build operator container åœ¨ K8s ä¸­éƒ¨ç½² operator åœ¨ K8s ä¸­éƒ¨ç½²è‡ªå·±å®šç¾©çš„ custom resource   çµèª  å‰è¨€ åœ¨æ¥è§¸ Kubernetes ä¸€é™£å­å¾Œï¼Œæœƒç™¼ç¾ä¸€å † operators ã€‚
è€Œå¾ˆæ®˜å¿µderï¼Œè‡ªå·±åˆ°ç›®å‰éƒ½é‚„æ²’æœ‰çœŸæ­£å¥½å¥½çš„ç©éã€‚
é›–ç„¶åœ¨ operator-sdk å‡ºç¾ä»¥å‰ï¼Œæœ‰å¾ˆå¤šäººéƒ½è‡ªå·±æ‰‹åˆ» operatorï¼Œä¸éæ—¢ç„¶ operator ç›®å‰éƒ½æœ‰å€‹ Framework äº†ï¼Œç•¶ç„¶å°±ä¾†ç©å®ƒå›‰ï¼
Operator Framework æ˜¯ä»€éº¼  æ˜¯ä¸€å€‹ open source toolkit ç®¡ç† Kubernetes native applications, called operators, in an effective, automated, and scalable way é€™å€‹ Framework æœ‰å…©å€‹ä¸»è¦çš„å°ˆæ¡ˆï¼š  Operator SDK: å°±å¯ä»¥ç”¨å®ƒ build operatorã€‚ Operator Lifecycle Manager (OLM): å¯ä»¥ç®¡ç† operators å’Œ CRUD Kubernetes resource ç”¨&hellip;ã€‚(å¯ä»¥åˆ°é€™é‚Šç©ç©ï¼šhttps://www." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bestsamina.github.io/posts/2019-02-04-first-operator-sdk-helm/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-02-04T14:33:14+08:00" />
<meta property="article:modified_time" content="2019-02-04T14:33:14+08:00" />


  <meta itemprop="name" content="ç¬¬ä¸€æ¬¡ç© operator-sdk å°±ä¸Šæ‰‹">
<meta itemprop="description" content="æ–‡ç« è„ˆçµ¡  å‰è¨€ Operator Framework æ˜¯ä»€éº¼ èªè­˜ operator-sdk CLI å¯¦ä½œé–‹å§‹  å»ºç«‹ K8s ç’°å¢ƒ å®‰è£ operator-sdk CLI ç”¨ operator-sdk CLI å»ºç«‹ä¸€å€‹ operator äº†è§£ä¸€ä¸‹æ–°ç”¢ç”Ÿçš„ helm operator ä¸­çš„æª”æ¡ˆ ç·¨è¼¯æª”æ¡ˆ å…ˆåœ¨ K8s ä¸­ deploy CRD Build operator container åœ¨ K8s ä¸­éƒ¨ç½² operator åœ¨ K8s ä¸­éƒ¨ç½²è‡ªå·±å®šç¾©çš„ custom resource   çµèª  å‰è¨€ åœ¨æ¥è§¸ Kubernetes ä¸€é™£å­å¾Œï¼Œæœƒç™¼ç¾ä¸€å † operators ã€‚
è€Œå¾ˆæ®˜å¿µderï¼Œè‡ªå·±åˆ°ç›®å‰éƒ½é‚„æ²’æœ‰çœŸæ­£å¥½å¥½çš„ç©éã€‚
é›–ç„¶åœ¨ operator-sdk å‡ºç¾ä»¥å‰ï¼Œæœ‰å¾ˆå¤šäººéƒ½è‡ªå·±æ‰‹åˆ» operatorï¼Œä¸éæ—¢ç„¶ operator ç›®å‰éƒ½æœ‰å€‹ Framework äº†ï¼Œç•¶ç„¶å°±ä¾†ç©å®ƒå›‰ï¼
Operator Framework æ˜¯ä»€éº¼  æ˜¯ä¸€å€‹ open source toolkit ç®¡ç† Kubernetes native applications, called operators, in an effective, automated, and scalable way é€™å€‹ Framework æœ‰å…©å€‹ä¸»è¦çš„å°ˆæ¡ˆï¼š  Operator SDK: å°±å¯ä»¥ç”¨å®ƒ build operatorã€‚ Operator Lifecycle Manager (OLM): å¯ä»¥ç®¡ç† operators å’Œ CRUD Kubernetes resource ç”¨&hellip;ã€‚(å¯ä»¥åˆ°é€™é‚Šç©ç©ï¼šhttps://www."><meta itemprop="datePublished" content="2019-02-04T14:33:14+08:00" />
<meta itemprop="dateModified" content="2019-02-04T14:33:14+08:00" />
<meta itemprop="wordCount" content="972">
<meta itemprop="keywords" content="operator-sdk,operator,Kubernetes,helm,Cloud-Native," />
</head>
<body>

  <header style="background-image:linear-gradient(
      rgba(0,0,0,0.4),rgba(0,0,0,0.4)
    ),url(&#39;https://bestsamina.github.io/images/default-sidebar.jpg&#39;)">
  <div class="intro">
    <div class="logo-container">
      <a href="/">
        <img src='https://bestsamina.github.io/images/person.jpg' alt="Profile Scrum framework" class="rounded-logo">
      </a>
    </div>
    <h3>Hi, I'm Samina ğŸ‘‹</h3>
    <h4>This is my Life & Technological Journey</h4>
    <div class="menu">
      

        <p>
            <a href="/posts/">
                Post
            </a>
        </p>

        <p>
            <a href="/about/">
                About
            </a>
        </p>

        <p>
            <a href="/tags/">
                Tags
            </a>
        </p>

        <p>
            <a href="/categories/">
                Categories
            </a>
        </p>

        <p>
            <a href="/page/awesome-blogs/">
                Awesome-blogs
            </a>
        </p>

      
    </div>
  </div>

  <div class="socials">
      
  
    <a href="https://github.com/sufuf3" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M102.679 0H12.32C5.52 0 0 5.519 0 12.321v90.358C0 109.48 5.519 115 12.321 115h90.358c6.802 0 12.321-5.519 12.321-12.321V12.32C115 5.52 109.481 0 102.679 0zM71.182 98.494c-2.156.385-2.952-.95-2.952-2.053 0-1.386.051-8.471.051-14.195 0-4.005-1.335-6.546-2.9-7.881C74.878 73.313 84.89 72.003 84.89 55.6c0-4.671-1.669-7.007-4.39-10.01.436-1.105 1.9-5.648-.436-11.552-3.568-1.104-11.731 4.595-11.731 4.595-3.389-.95-7.06-1.438-10.679-1.438-3.62 0-7.29.488-10.679 1.438 0 0-8.163-5.699-11.73-4.595-2.337 5.878-.899 10.422-.437 11.551-2.72 3.004-4.004 5.34-4.004 10.011 0 16.326 9.574 17.712 19.072 18.765-1.232 1.104-2.336 3.003-2.72 5.724-2.44 1.104-8.677 3.004-12.4-3.568-2.335-4.056-6.545-4.39-6.545-4.39-4.159-.05-.282 2.619-.282 2.619 2.772 1.283 4.723 6.212 4.723 6.212 2.49 7.624 14.4 5.057 14.4 5.057 0 3.568.052 9.37.052 10.422 0 1.104-.77 2.438-2.952 2.053C27.21 92.821 15.35 76.701 15.35 57.86c0-23.564 18.02-41.456 41.585-41.456s42.663 17.892 42.663 41.456c.026 18.842-11.474 34.988-28.416 40.635zM46 82.81c-.488.103-.95-.102-1.001-.436-.051-.385.282-.719.77-.822.488-.05.95.154 1.001.488.077.334-.257.668-.77.77zm-2.439-.23c0 .333-.385.615-.898.615-.565.052-.95-.23-.95-.616 0-.333.385-.616.899-.616.487-.051.95.231.95.616zm-3.516-.283c-.103.334-.616.488-1.053.334-.488-.103-.821-.488-.719-.822.103-.334.617-.488 1.053-.385.513.154.847.54.719.873zm-3.158-1.386c-.23.282-.718.23-1.104-.154-.385-.334-.487-.822-.23-1.053.23-.282.718-.23 1.103.154.334.334.462.847.231 1.053zm-2.336-2.336c-.23.154-.667 0-.95-.385-.282-.385-.282-.822 0-1.001.283-.231.72-.052.95.333.283.385.283.847 0 1.053zm-1.668-2.49c-.231.23-.616.103-.899-.154-.282-.334-.333-.719-.102-.899.23-.23.616-.102.898.154.282.334.334.72.103.899zm-1.72-1.9c-.103.231-.436.283-.719.103-.334-.154-.488-.436-.385-.667.103-.154.385-.231.719-.103.334.18.488.462.385.667z"/>
  
  </svg>
</div>
</a>
  

  
    <a href="https://gitlab.com/sufuf3" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M23.76 5.544c-.693-1.991-3.512-1.991-4.228 0L6.892 44.653h29.532c-.022 0-12.663-39.11-12.663-39.11zM.426 64.34c-.582 1.79.067 3.782 1.589 4.923l55.464 41.167-50.61-65.778L.426 64.34zm35.977-19.688L57.5 110.43l21.098-65.778H36.402zm78.173 19.688l-6.444-19.688L57.5 110.43l55.464-41.167a4.475 4.475 0 0 0 1.61-4.923zM95.468 5.544c-.694-1.991-3.513-1.991-4.229 0L78.576 44.653h29.533L95.468 5.543z" />
  
  </svg>
</div>
</a>
  

  
    <a href="https://medium.com/@sufuf3149" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M0 0v115h115V0H0zm95.542 27.235l-6.16 5.905a1.81 1.81 0 0 0-.693 1.72v43.458c-.103.667.154 1.335.693 1.72l6.032 5.904v1.31h-30.29v-1.259l6.238-6.058c.616-.616.616-.795.616-1.72V43.074L54.625 87.123h-2.336l-20.202-44.05v29.52c-.18 1.233.257 2.49 1.13 3.39l8.111 9.83v1.31H18.277v-1.31l8.111-9.83a3.93 3.93 0 0 0 1.053-3.39v-34.14a2.93 2.93 0 0 0-.976-2.516l-7.213-8.702v-1.309h22.41l17.301 37.991 15.222-37.965h21.357v1.283z"/>
  
  </svg>
</div>
</a>
  

  
    <a href="https://twitter.com/sufuf3149" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M102.679 0H12.32C5.52 0 0 5.519 0 12.321v90.358C0 109.48 5.519 115 12.321 115h90.358c6.802 0 12.321-5.519 12.321-12.321V12.32C115 5.52 109.481 0 102.679 0zM90.126 40.763c.051.72.051 1.464.051 2.182 0 22.256-16.942 47.9-47.9 47.9-9.548 0-18.404-2.772-25.848-7.547 1.36.154 2.67.205 4.055.205 7.881 0 15.12-2.67 20.895-7.187-7.392-.154-13.604-5.006-15.735-11.68 2.593.385 4.929.385 7.598-.308a16.837 16.837 0 0 1-13.476-16.531v-.205a16.824 16.824 0 0 0 7.598 2.13 16.8 16.8 0 0 1-7.496-14.016c0-3.131.822-6.006 2.285-8.496a47.803 47.803 0 0 0 34.705 17.61c-2.387-11.424 6.161-20.69 16.429-20.69 4.851 0 9.215 2.027 12.296 5.313a32.99 32.99 0 0 0 10.678-4.056 16.792 16.792 0 0 1-7.393 9.267c3.389-.36 6.674-1.31 9.703-2.618a35.437 35.437 0 0 1-8.445 8.727z"/>
  
  </svg>
</div>
</a>
  

  </div>
</header>

<div class="mobile-header">
  <p> Samina Website </p>
  <div class="hamburger">
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
  </div>
</div>

<div class="overlay-menu">
  <header>
    <div class="intro">
      <div class="logo-container">
        <a href="/">
          <img src='https://bestsamina.github.io/images/person.jpg' alt="Profile Scrum framework" class="rounded-logo">
        </a>
      </div>
      <h3>Hi, I'm Samina ğŸ‘‹</h3>
      <h4>This is my Life & Technological Journey</h4>
      <div class="menu">
        

        <p>
            <a href="/posts/">
                Post
            </a>
        </p>

        <p>
            <a href="/about/">
                About
            </a>
        </p>

        <p>
            <a href="/tags/">
                Tags
            </a>
        </p>

        <p>
            <a href="/categories/">
                Categories
            </a>
        </p>

        <p>
            <a href="/page/awesome-blogs/">
                Awesome-blogs
            </a>
        </p>

        
      </div>
    </div>

    <div class="socials">
        
  
    <a href="https://github.com/sufuf3" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M102.679 0H12.32C5.52 0 0 5.519 0 12.321v90.358C0 109.48 5.519 115 12.321 115h90.358c6.802 0 12.321-5.519 12.321-12.321V12.32C115 5.52 109.481 0 102.679 0zM71.182 98.494c-2.156.385-2.952-.95-2.952-2.053 0-1.386.051-8.471.051-14.195 0-4.005-1.335-6.546-2.9-7.881C74.878 73.313 84.89 72.003 84.89 55.6c0-4.671-1.669-7.007-4.39-10.01.436-1.105 1.9-5.648-.436-11.552-3.568-1.104-11.731 4.595-11.731 4.595-3.389-.95-7.06-1.438-10.679-1.438-3.62 0-7.29.488-10.679 1.438 0 0-8.163-5.699-11.73-4.595-2.337 5.878-.899 10.422-.437 11.551-2.72 3.004-4.004 5.34-4.004 10.011 0 16.326 9.574 17.712 19.072 18.765-1.232 1.104-2.336 3.003-2.72 5.724-2.44 1.104-8.677 3.004-12.4-3.568-2.335-4.056-6.545-4.39-6.545-4.39-4.159-.05-.282 2.619-.282 2.619 2.772 1.283 4.723 6.212 4.723 6.212 2.49 7.624 14.4 5.057 14.4 5.057 0 3.568.052 9.37.052 10.422 0 1.104-.77 2.438-2.952 2.053C27.21 92.821 15.35 76.701 15.35 57.86c0-23.564 18.02-41.456 41.585-41.456s42.663 17.892 42.663 41.456c.026 18.842-11.474 34.988-28.416 40.635zM46 82.81c-.488.103-.95-.102-1.001-.436-.051-.385.282-.719.77-.822.488-.05.95.154 1.001.488.077.334-.257.668-.77.77zm-2.439-.23c0 .333-.385.615-.898.615-.565.052-.95-.23-.95-.616 0-.333.385-.616.899-.616.487-.051.95.231.95.616zm-3.516-.283c-.103.334-.616.488-1.053.334-.488-.103-.821-.488-.719-.822.103-.334.617-.488 1.053-.385.513.154.847.54.719.873zm-3.158-1.386c-.23.282-.718.23-1.104-.154-.385-.334-.487-.822-.23-1.053.23-.282.718-.23 1.103.154.334.334.462.847.231 1.053zm-2.336-2.336c-.23.154-.667 0-.95-.385-.282-.385-.282-.822 0-1.001.283-.231.72-.052.95.333.283.385.283.847 0 1.053zm-1.668-2.49c-.231.23-.616.103-.899-.154-.282-.334-.333-.719-.102-.899.23-.23.616-.102.898.154.282.334.334.72.103.899zm-1.72-1.9c-.103.231-.436.283-.719.103-.334-.154-.488-.436-.385-.667.103-.154.385-.231.719-.103.334.18.488.462.385.667z"/>
  
  </svg>
</div>
</a>
  

  
    <a href="https://gitlab.com/sufuf3" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M23.76 5.544c-.693-1.991-3.512-1.991-4.228 0L6.892 44.653h29.532c-.022 0-12.663-39.11-12.663-39.11zM.426 64.34c-.582 1.79.067 3.782 1.589 4.923l55.464 41.167-50.61-65.778L.426 64.34zm35.977-19.688L57.5 110.43l21.098-65.778H36.402zm78.173 19.688l-6.444-19.688L57.5 110.43l55.464-41.167a4.475 4.475 0 0 0 1.61-4.923zM95.468 5.544c-.694-1.991-3.513-1.991-4.229 0L78.576 44.653h29.533L95.468 5.543z" />
  
  </svg>
</div>
</a>
  

  
    <a href="https://medium.com/@sufuf3149" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M0 0v115h115V0H0zm95.542 27.235l-6.16 5.905a1.81 1.81 0 0 0-.693 1.72v43.458c-.103.667.154 1.335.693 1.72l6.032 5.904v1.31h-30.29v-1.259l6.238-6.058c.616-.616.616-.795.616-1.72V43.074L54.625 87.123h-2.336l-20.202-44.05v29.52c-.18 1.233.257 2.49 1.13 3.39l8.111 9.83v1.31H18.277v-1.31l8.111-9.83a3.93 3.93 0 0 0 1.053-3.39v-34.14a2.93 2.93 0 0 0-.976-2.516l-7.213-8.702v-1.309h22.41l17.301 37.991 15.222-37.965h21.357v1.283z"/>
  
  </svg>
</div>
</a>
  

  
    <a href="https://twitter.com/sufuf3149" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M102.679 0H12.32C5.52 0 0 5.519 0 12.321v90.358C0 109.48 5.519 115 12.321 115h90.358c6.802 0 12.321-5.519 12.321-12.321V12.32C115 5.52 109.481 0 102.679 0zM90.126 40.763c.051.72.051 1.464.051 2.182 0 22.256-16.942 47.9-47.9 47.9-9.548 0-18.404-2.772-25.848-7.547 1.36.154 2.67.205 4.055.205 7.881 0 15.12-2.67 20.895-7.187-7.392-.154-13.604-5.006-15.735-11.68 2.593.385 4.929.385 7.598-.308a16.837 16.837 0 0 1-13.476-16.531v-.205a16.824 16.824 0 0 0 7.598 2.13 16.8 16.8 0 0 1-7.496-14.016c0-3.131.822-6.006 2.285-8.496a47.803 47.803 0 0 0 34.705 17.61c-2.387-11.424 6.161-20.69 16.429-20.69 4.851 0 9.215 2.027 12.296 5.313a32.99 32.99 0 0 0 10.678-4.056 16.792 16.792 0 0 1-7.393 9.267c3.389-.36 6.674-1.31 9.703-2.618a35.437 35.437 0 0 1-8.445 8.727z"/>
  
  </svg>
</div>
</a>
  

    </div>
  </header>
</div>

  <div class="content-wrapper">
    
      <div class="breadcrumb">
  





<span >
  <a href="https://bestsamina.github.io/">Home</a>
   / 
</span>


<span >
  <a href="https://bestsamina.github.io/posts/">POST</a>
   / 
</span>


<span  class="active">
  <a href="https://bestsamina.github.io/posts/2019-02-04-first-operator-sdk-helm/">ç¬¬ä¸€æ¬¡ç© operator-sdk å°±ä¸Šæ‰‹</a>
  
</span>

</div>

    
    <main id="content" class="posts">

<h1>ç¬¬ä¸€æ¬¡ç© operator-sdk å°±ä¸Šæ‰‹</h1>


<div class="reading-time">
  <div class="icon">
  <svg width="18px" height="18px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M57.5 11C29.05 11 6 34.05 6 62.5S29.05 114 57.5 114 109 90.95 109 62.5 85.95 11 57.5 11zm0 93.032c-22.947 0-41.532-18.585-41.532-41.532 0-22.947 18.585-41.532 41.532-41.532 22.947 0 41.532 18.585 41.532 41.532 0 22.947-18.585 41.532-41.532 41.532zm12.833-21.68L52.703 69.54a2.508 2.508 0 0 1-1.018-2.015V33.427a2.5 2.5 0 0 1 2.492-2.492h6.646a2.5 2.5 0 0 1 2.492 2.492v29.426l13.871 10.092c1.122.81 1.35 2.368.54 3.49l-3.904 5.377a2.51 2.51 0 0 1-3.489.54z"/>
  
  </svg>
</div>

  <span>5 minutes</span>
</div>

<div class="published-date">
  <div class="icon">
  <svg width="18px" height="18px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M77.577 51.23a1.807 1.807 0 0 0-2.2.342l-27.562 27.79a1.807 1.807 0 0 1-2.2.342l-14.008-9.702a1.807 1.807 0 0 0-2.2.342l-1.952 1.968c-.287.22-.456.568-.455.936.001.37.172.716.46.934L45.637 86.77a1.807 1.807 0 0 0 2.2-.342l31.709-31.97c.287-.22.456-.567.455-.936a1.175 1.175 0 0 0-.46-.933l-1.963-1.36z"/><path d="M97.304 20H80.512c-.041.34-.063.683-.064 1.026a5.986 5.986 0 0 0 1.256 4.1c.054.003.103.02.157.025a4.881 4.881 0 0 1 1.865-.025c3.05.562 4.984 3.907 4.32 7.47-.666 3.563-3.678 5.996-6.728 5.433a4.932 4.932 0 0 1-2.437-1.258c-6.018-1.378-10.445-7.795-10.445-15.745 0-.347.023-.685.04-1.026H34.579c-.041.34-.063.683-.064 1.026a5.986 5.986 0 0 0 1.256 4.1c.054.003.103.02.157.025a4.881 4.881 0 0 1 1.865-.025c3.05.562 4.984 3.907 4.32 7.47-.666 3.563-3.678 5.996-6.728 5.433a4.932 4.932 0 0 1-2.437-1.258c-6.018-1.378-10.445-7.795-10.445-15.745 0-.22.019-.434.025-.652a9.788 9.788 0 0 0-5.697 4.471 9.683 9.683 0 0 0-2.65 4.764L1.158 92.871c-.965 4.689 2.6 8.503 7.948 8.503h6.334v2.673c-.077 5.41 4.263 9.861 9.705 9.953h72.16c5.438-.095 9.774-4.546 9.694-9.953V29.953c.08-5.407-4.256-9.858-9.695-9.953zM10.078 96.653c-2.378 0-3.964-1.697-3.535-3.782L16.637 43.84h80.787L87.331 92.871a5.254 5.254 0 0 1-5.091 3.782H10.078zm91.535 7.394c.036 2.403-1.891 4.382-4.308 4.424h-72.16c-2.42-.04-4.352-2.018-4.32-4.424v-2.673h60.443c5.348 0 10.484-3.814 11.449-8.503l8.897-43.215v54.391z"/><path d="M34.814 33c1.243 0 2.251-1.057 2.251-2.36 0-1.305-1.008-2.362-2.25-2.362-2.04 0-4.313-3.194-4.313-7.778s2.272-7.778 4.312-7.778c1.227 0 2.536 1.163 3.386 3.084H43C41.716 11.19 38.578 8 34.814 8 29.871 8 26 13.49 26 20.5c0 7.009 3.871 12.5 8.814 12.5z"/>
  
  </svg>
</div>

  <span>February 4, 2019</span>
</div>
<div class="page-tag">
  <div class="page-tag">Category: </div>
    
      <div class="page-tag" id="tags">
        
          <div class="page-tag">
            <a href="https://bestsamina.github.io/categories/cloud-native">Cloud-Native</a>
          </div>
        
      </div>
    
</div>
<div class="page-tag">
  <div class="page-tag">tags: </div>
    
      <div class="page-tag" id="tags">
        
          <div class="page-tag">
            <a href="https://bestsamina.github.io/tags/operator-sdk">operator-sdk</a>
          </div>
        
          <div class="page-tag">
            <a href="https://bestsamina.github.io/tags/operator">operator</a>
          </div>
        
          <div class="page-tag">
            <a href="https://bestsamina.github.io/tags/kubernetes">Kubernetes</a>
          </div>
        
          <div class="page-tag">
            <a href="https://bestsamina.github.io/tags/helm">helm</a>
          </div>
        
          <div class="page-tag">
            <a href="https://bestsamina.github.io/tags/cloud-native">Cloud-Native</a>
          </div>
        
      </div>
    
</div>
<br>
<span>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#æ–‡ç« è„ˆçµ¡">æ–‡ç« è„ˆçµ¡</a></li>
    <li><a href="#å‰è¨€">å‰è¨€</a></li>
    <li><a href="#operator-framework-æ˜¯ä»€éº¼">Operator Framework æ˜¯ä»€éº¼</a></li>
    <li><a href="#èªè­˜-operator-sdk-cli">èªè­˜ operator-sdk CLI</a></li>
    <li><a href="#å¯¦ä½œé–‹å§‹">å¯¦ä½œé–‹å§‹</a>
      <ul>
        <li><a href="#1-å»ºç«‹-k8s-ç’°å¢ƒ">1. å»ºç«‹ K8s ç’°å¢ƒ</a></li>
        <li><a href="#2-å®‰è£-operator-sdk-cli">2. å®‰è£ operator-sdk CLI</a></li>
        <li><a href="#3-ç”¨-operator-sdk-cli-å»ºç«‹ä¸€å€‹-operator">3. ç”¨ operator-sdk CLI å»ºç«‹ä¸€å€‹ operator</a></li>
        <li><a href="#4-äº†è§£ä¸€ä¸‹æ–°ç”¢ç”Ÿçš„-helm-operator-ä¸­çš„æª”æ¡ˆ">4. äº†è§£ä¸€ä¸‹æ–°ç”¢ç”Ÿçš„ helm operator ä¸­çš„æª”æ¡ˆ</a></li>
        <li><a href="#5-ç·¨è¼¯æª”æ¡ˆ">5. ç·¨è¼¯æª”æ¡ˆ</a></li>
        <li><a href="#6-å…ˆåœ¨-k8s-ä¸­-deploy-crd">6. å…ˆåœ¨ K8s ä¸­ deploy CRD</a></li>
        <li><a href="#7-build-operator-container">7. Build operator container</a></li>
        <li><a href="#8-åœ¨-k8s-ä¸­éƒ¨ç½²-operator">8. åœ¨ K8s ä¸­éƒ¨ç½² operator</a></li>
        <li><a href="#9-åœ¨-k8s-ä¸­éƒ¨ç½²è‡ªå·±å®šç¾©çš„-custom-resource">9. åœ¨ K8s ä¸­éƒ¨ç½²è‡ªå·±å®šç¾©çš„ custom resource</a></li>
      </ul>
    </li>
    <li><a href="#çµèª">çµèª</a></li>
    <li><a href="#åƒè€ƒé€£çµ">åƒè€ƒé€£çµ</a></li>
  </ul>
</nav>
</span>


<h2 id="æ–‡ç« è„ˆçµ¡">æ–‡ç« è„ˆçµ¡</h2>
<ul>
<li>å‰è¨€</li>
<li>Operator Framework æ˜¯ä»€éº¼</li>
<li>èªè­˜ operator-sdk CLI</li>
<li>å¯¦ä½œé–‹å§‹
<ol>
<li>å»ºç«‹ K8s ç’°å¢ƒ</li>
<li>å®‰è£ operator-sdk CLI</li>
<li>ç”¨ operator-sdk CLI å»ºç«‹ä¸€å€‹ operator</li>
<li>äº†è§£ä¸€ä¸‹æ–°ç”¢ç”Ÿçš„ helm operator ä¸­çš„æª”æ¡ˆ</li>
<li>ç·¨è¼¯æª”æ¡ˆ</li>
<li>å…ˆåœ¨ K8s ä¸­ deploy CRD</li>
<li>Build operator container</li>
<li>åœ¨ K8s ä¸­éƒ¨ç½² operator</li>
<li>åœ¨ K8s ä¸­éƒ¨ç½²è‡ªå·±å®šç¾©çš„ custom resource</li>
</ol>
</li>
<li>çµèª</li>
</ul>
<h2 id="å‰è¨€">å‰è¨€</h2>
<p>åœ¨æ¥è§¸ Kubernetes ä¸€é™£å­å¾Œï¼Œæœƒç™¼ç¾ä¸€å † operators ã€‚<br>
è€Œå¾ˆæ®˜å¿µderï¼Œè‡ªå·±åˆ°ç›®å‰éƒ½é‚„æ²’æœ‰çœŸæ­£å¥½å¥½çš„ç©éã€‚<br>
é›–ç„¶åœ¨ operator-sdk å‡ºç¾ä»¥å‰ï¼Œæœ‰å¾ˆå¤šäººéƒ½è‡ªå·±æ‰‹åˆ» operatorï¼Œä¸éæ—¢ç„¶ operator ç›®å‰éƒ½æœ‰å€‹ Framework äº†ï¼Œç•¶ç„¶å°±ä¾†ç©å®ƒå›‰ï¼</p>
<h2 id="operator-framework-æ˜¯ä»€éº¼">Operator Framework æ˜¯ä»€éº¼</h2>
<ul>
<li>æ˜¯ä¸€å€‹ open source toolkit</li>
<li>ç®¡ç† Kubernetes native applications, called operators, in an effective, automated, and scalable way</li>
<li>é€™å€‹ Framework æœ‰å…©å€‹ä¸»è¦çš„å°ˆæ¡ˆï¼š
<ul>
<li><a href="https://github.com/operator-framework/operator-sdk">Operator SDK</a>: å°±å¯ä»¥ç”¨å®ƒ build operatorã€‚</li>
<li><a href="https://github.com/operator-framework/operator-lifecycle-manager">Operator Lifecycle Manager</a> (OLM): å¯ä»¥ç®¡ç† operators å’Œ CRUD Kubernetes resource ç”¨&hellip;ã€‚(å¯ä»¥åˆ°é€™é‚Šç©ç©ï¼šhttps://www.katacoda.com/openshift/courses/operatorframework/operator-lifecycle-manager ï¼Œç°¡å–®ç©å®Œå¾Œæœƒç™¼ç¾åŠŸèƒ½è »å¼·å¤§çš„)</li>
</ul>
</li>
</ul>
<p>è©³ç´°çš„ä»‹ç´¹è«‹åƒé–±ï¼šhttps://coreos.com/blog/introducing-operator-framework</p>
<h2 id="èªè­˜-operator-sdk-cli">èªè­˜ operator-sdk CLI</h2>
<pre tabindex="0"><code>$ operator-sdk -h
An SDK for building operators with ease

Usage:
  operator-sdk [command]

Available Commands:
  add         Adds a controller or resource to the project
  build       Compiles code and builds artifacts
  completion  Generators for shell completions
  generate    Invokes specific generator
  help        Help about any command
  migrate     Adds source code to an operator
  new         Creates a new operator application
  olm-catalog Invokes a olm-catalog command
  print-deps  Print Golang packages and versions required to run the operator
  run         Runs a generic operator
  scorecard   Run scorecard tests
  test        Tests the operator
  up          Launches the operator

$ operator-sdk --version
operator-sdk version v0.4.0+git
</code></pre><p>æœ¬æ¬¡æœƒç”¨åˆ°çš„æŒ‡ä»¤å°±åªæœ‰ä¸€å€‹ï¼š<code>operator-sdk new</code> - ç”¢ç”Ÿä¸€å€‹æ–°çš„ operator å°ˆæ¡ˆ</p>
<h2 id="å¯¦ä½œé–‹å§‹">å¯¦ä½œé–‹å§‹</h2>
<h3 id="1-å»ºç«‹-k8s-ç’°å¢ƒ">1. å»ºç«‹ K8s ç’°å¢ƒ</h3>
<p>Ref: <a href="https://github.com/operator-framework/operator-sdk#prerequisites">https://github.com/operator-framework/operator-sdk#prerequisites</a></p>
<ul>
<li>éœ€è¦æº–å‚™çš„ç’°å¢ƒæœ‰ï¼š
<ul>
<li>dep version v0.5.0+.</li>
<li>git</li>
<li>go version v1.10+.</li>
<li>docker version 17.03+.</li>
<li>kubectl version v1.11.0+.</li>
<li>Access to a kubernetes v.1.11.0+ cluster.</li>
<li>Helm &amp; tiller server</li>
</ul>
</li>
</ul>
<p>åƒè€ƒå®‰è£ï¼š</p>
<ul>
<li><a href="https://github.com/sufuf3/play-k8s-operator/blob/master/vagrant/Vagrantfile">CentOS with kubeadm@1.12.4</a>: ä»¥ä¸‹ç¯„ä¾‹éƒ½æ˜¯ä½¿ç”¨é€™å€‹ VM ä¾†å¯¦ä½œçš„</li>
<li><a href="https://github.com/sufuf3/hands-on-w-tutorials/tree/master/2019-01-03">Ubuntu with kubeadm@1.12.4</a></li>
</ul>
<h3 id="2-å®‰è£-operator-sdk-cli">2. å®‰è£ operator-sdk CLI</h3>
<p>åŸ·è¡Œæ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>go get -u github.com/golang/dep/cmd/dep
go get -u github.com/operator-framework/operator-sdk
cd ~/go/src/github.com/operator-framework/operator-sdk
make dep
make install
</code></pre><h3 id="3-ç”¨-operator-sdk-cli-å»ºç«‹ä¸€å€‹-operator">3. ç”¨ operator-sdk CLI å»ºç«‹ä¸€å€‹ operator</h3>
<p>åŸ·è¡Œæ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>mkdir -p $GOPATH/src/github.com/&lt;GitHub_ID&gt;
cd $GOPATH/src/github.com/&lt;GitHub_ID&gt;
operator-sdk new &lt;GitHub_Repo_Name&gt;
cd &lt;GitHub_Repo_Name&gt;/
</code></pre><p>å› ç‚ºä¹‹å¾Œé–‹ç™¼å…¶ä»–å°ˆæ¡ˆçš„é—œä¿‚ï¼Œæœ¬æ¬¡ä½¿ç”¨ helm ä¾†ç·´ç¿’ã€‚ç”¢ç”Ÿæ–°å°ˆæ¡ˆçš„æ–¹å¼å¦‚ä¸‹ï¼š
<code>operator-sdk new &lt;project-name&gt; --type=helm --kind=&lt;kind&gt; --api-version=&lt;group/version&gt;</code></p>
<ul>
<li><code>--type=helm</code> æ˜¯ä¾†å»ºç«‹ Helm operator operator ç”¨çš„ã€‚</li>
<li>Required: <code>--kind</code> - æ˜¯æˆ‘å€‘æƒ³æ‰“ç®— CRD è¦å®šç¾©çš„ kind</li>
<li>Required: <code>--api-version</code> - æ˜¯æˆ‘å€‘æƒ³è¦åœ¨é€™å°ˆæ¡ˆä¸­çš„ CRD æƒ³å®šç¾©å“ªæ¨£çš„ group/versionã€‚</li>
</ul>
<p>å¦‚ï¼š</p>
<pre tabindex="0"><code>$ mkdir -p $GOPATH/src/github.com/sufuf3
$ cd $GOPATH/src/github.com/sufuf3
$ operator-sdk new play-k8s-operator --api-version=samina.fu.com/v1alpha1 --kind=MyTest --type helm
INFO[0000] Creating new Helm operator &#39;play-k8s-operator&#39;.
INFO[0000] Create helm-charts/mytest/
INFO[0000] Create build/Dockerfile
INFO[0000] Create watches.yaml
INFO[0000] Create deploy/service_account.yaml
INFO[0000] Create deploy/role.yaml
INFO[0000] Create deploy/role_binding.yaml
INFO[0000] Create deploy/operator.yaml
INFO[0000] Create deploy/crds/samina_v1alpha1_mytest_crd.yaml
INFO[0000] Create deploy/crds/samina_v1alpha1_mytest_cr.yaml
INFO[0000] Run git init ...
Initialized empty Git repository in /home/vagrant/go/src/github.com/sufuf3/play-k8s-operator/.git/
INFO[0000] Run git init done
INFO[0000] Project creation complete.
</code></pre><p>è·‘å®Œ <code>operator-sdk new &lt;project-name&gt; --type=helm --kind=&lt;kind&gt; --api-version=&lt;group/version&gt;</code>ï¼Œé€²åˆ°è³‡æ–™å¤¾ä¸­æœƒç™¼ç¾å®ƒç”¢ç”Ÿå¥½çš„æª”æ¡ˆï¼Œä¸¦ä¸”ç”¨ git log æœƒç™¼ç¾æœ‰ä¸€å€‹ commit</p>
<pre tabindex="0"><code>$ cd play-k8s-operator/
$ tree
.
â”œâ”€â”€ build
â”‚Â Â  â””â”€â”€ Dockerfile
â”œâ”€â”€ deploy
â”‚Â Â  â”œâ”€â”€ crds
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ samina_v1alpha1_mytest_crd.yaml
â”‚Â Â  â”‚Â Â  â””â”€â”€ samina_v1alpha1_mytest_cr.yaml
â”‚Â Â  â”œâ”€â”€ operator.yaml
â”‚Â Â  â”œâ”€â”€ role_binding.yaml
â”‚Â Â  â”œâ”€â”€ role.yaml
â”‚Â Â  â””â”€â”€ service_account.yaml
â”œâ”€â”€ helm-charts
â”‚Â Â  â””â”€â”€ mytest
â”‚Â Â      â”œâ”€â”€ charts
â”‚Â Â      â”œâ”€â”€ Chart.yaml
â”‚Â Â      â”œâ”€â”€ templates
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ deployment.yaml
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ _helpers.tpl
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ ingress.yaml
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ NOTES.txt
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ service.yaml
â”‚Â Â      â”‚Â Â  â””â”€â”€ tests
â”‚Â Â      â”‚Â Â      â””â”€â”€ test-connection.yaml
â”‚Â Â      â””â”€â”€ values.yaml
â””â”€â”€ watches.yaml

$ git log
commit f0a174ce1deca8ef3b38c911b98b102ca7dfd27f
Author: Samina Fu &lt;sufuf3@gmail.com&gt;
Date:   Sat Feb 2 12:11:10 2019 +0000

    INITIAL COMMIT
</code></pre><h3 id="4-äº†è§£ä¸€ä¸‹æ–°ç”¢ç”Ÿçš„-helm-operator-ä¸­çš„æª”æ¡ˆ">4. äº†è§£ä¸€ä¸‹æ–°ç”¢ç”Ÿçš„ helm operator ä¸­çš„æª”æ¡ˆ</h3>
<p>Ref: <a href="https://github.com/operator-framework/operator-sdk/blob/master/doc/helm/project_layout.md">https://github.com/operator-framework/operator-sdk/blob/master/doc/helm/project_layout.md</a></p>
<p>å¾ä¸Šé¢çš„æª”æ¡ˆä¸­æœƒå‡ºç¾ä»¥ä¸‹çš„è³‡æ–™å¤¾å’Œæª”æ¡ˆï¼š</p>
<ul>
<li><strong><code>deploy</code></strong> è³‡æ–™å¤¾ï¼šåŒ…å«ä¸€çµ„å¯ä»¥ deploy åˆ° K8s cluser ä¸Šçš„ resource files
<ul>
<li><strong><code>deploy/service_account.yaml</code></strong>: å»ºç«‹ä¸€å€‹é€™å€‹å°ˆæ¡ˆåç¨±çš„ ServiceAccount</li>
<li><strong><code>deploy/role.yaml</code></strong>: å»ºç«‹ä¸€å€‹ role å®šç¾©å®ƒèƒ½å­˜å– K8s cluster çš„è¦å‰‡</li>
<li><strong><code>deploy/role_binding.yaml</code></strong>: æŠŠä¸Šé¢çš„ ServiceAccount å’Œ Role bind èµ·ä¾†ï¼Œä¹Ÿå°±æ˜¯èªªï¼Œè©² ServiceAccount æ“æœ‰é€™å€‹ Role å®šç¾©çš„å­˜å– rule</li>
<li><strong><code>deploy/operator.yaml</code></strong>: æ˜¯ deploy operator åˆ° K8s cluster ä¸Šçš„ deploymentï¼Œä½¿ç”¨çš„ ServiceAccount æ˜¯ æˆ‘å€‘åœ¨ <code>deploy/service_account.yaml</code> å®šç¾©çš„åç¨±</li>
<li><strong><code>deploy/crds/GROUP_VERSION_CRDNAME_crd.yaml</code></strong>: å°±æ˜¯æˆ‘å€‘è‡ªå·±å®šç¾©çš„ resource typeï¼ŒMore detail: <a href="https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/">Extend the Kubernetes API with CustomResourceDefinitions</a></li>
<li><strong><code>deploy/crds/GROUP_VERSION_CRDNAME_cr.yaml</code></strong>: æ˜¯æˆ‘å€‘è¦ deploy å®¢åˆ¶çš„ resourceï¼ŒCR ä»£è¡¨ Custom Resource ï¼ŒMore detail: <a href="https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/#create-custom-objects">Create custom objects</a>
è€Œæˆ‘å€‘ä¹Ÿä¸ç”¨æ“”å¿ƒè®Šæˆ K8s API ä¾†å‘¼å«æœƒå‡ºç¾å•é¡Œï¼Œå› ç‚ºé€™æª”æ¡ˆä¸­çš„ spec å°±æ˜¯å®Œå…¨è¤‡è£½ <code>helm-charts</code> åº•ä¸‹çš„ values.yamlï¼Œæ‰€ä»¥åŸæœ¬ç”¨ helm æ€éº¼å®šç¾© values.yaml ä¸­çš„å€¼ï¼Œé€™ä»½æª”æ¡ˆå°±æ€éº¼å®šç¾©ã€‚åéä¾†èªªï¼ŒåŸæœ¬æˆ‘å€‘çš„ values.yaml ä¸­çš„ key&amp;value æ€éº¼å¯«çš„ï¼Œåœ¨é€™é‚Šå°±æ€éº¼å¯«å›‰ï¼</li>
</ul>
</li>
<li><strong><code>helm-charts/&lt;kind&gt;</code></strong> è³‡æ–™å¤¾: æ˜¯ç†Ÿæ‚‰çš„ helm-chartsï¼Œç”¨ <code>helm create</code> æŒ‡ä»¤æœƒç”¢ç”Ÿå‡ºä¾†çš„æª”æ¡ˆã€‚</li>
<li><strong><code>build/Dockerfile</code></strong>: æ˜¯ operator çš„ Dockerfileï¼Œä¹‹å¾Œç•¶ç„¶è¦ docker build èµ·ä¾†</li>
<li><strong><code>watches.yaml</code></strong>: å…§å®¹åŒ…å« Group, Version, Kind, å’Œ Helm chart è·¯å¾‘ä½ç½®</li>
</ul>
<h3 id="5-ç·¨è¼¯æª”æ¡ˆ">5. ç·¨è¼¯æª”æ¡ˆ</h3>
<h4 id="1-watchesyaml">1. <code>watches.yaml</code></h4>
<p>default çš„ operator æœƒä¾æ“š <code>watches.yaml</code> é€™å€‹æª”æ¡ˆä¾†ç›£æ§ æˆ‘å€‘è‡ªå·±å®šç¾©çš„ kind é€™å€‹ resource çš„äº‹ä»¶ã€‚åŸºæœ¬ä¸Šï¼Œåœ¨æˆ‘å€‘åŸ·è¡Œ <code>operator-sdk new</code> å°±å·²ç¶“ä¾æ“šæˆ‘å€‘å®šç¾©çš„åç¨±ç”¢ç”Ÿå¥½ï¼Œæ‰€ä»¥é€™ä»½æª”æ¡ˆåŸºæœ¬ä¸Š<strong>ä¸éœ€è¦ä¿®æ”¹</strong>ã€‚</p>
<pre tabindex="0"><code>---
- version: v1alpha1
  group: samina.fu.com
  kind: MyTest
  chart: /opt/helm/helm-charts/mytest
</code></pre><h4 id="2-helm-charts">2. helm-charts</h4>
<p>ä¾è‡ªå·±å–œå¥½ä¾†ç·¨è¼¯è‡ªå·±çš„ helm-charts å›‰ï¼<br>
ä½¿ç”¨ <code>helm install --name NAME --dry-run --debug ./helm-charts/mytest/</code> ä¾† debugã€‚</p>
<p>åƒè€ƒï¼šhttps://github.com/sufuf3/play-k8s-operator/blob/master/helm-dry-run.log</p>
<h3 id="6-å…ˆåœ¨-k8s-ä¸­-deploy-crd">6. å…ˆåœ¨ K8s ä¸­ deploy CRD</h3>
<pre tabindex="0"><code>kubectl create -f deploy/crds/GROUP_VERSION_CRDNAME_crd.yaml
</code></pre><p>eg.</p>
<pre tabindex="0"><code>kubectl create -f deploy/crds/samina_v1alpha1_mytest_crd.yaml
</code></pre><p>ç„¶åä¸€ä¸ªæ–°çš„ RESTful API å°±å‰µå»ºäº†ï¼š</p>
<pre tabindex="0"><code>$ curl -s https://172.17.8.100:6443/apis/samina.fu.com/v1alpha1/namespaces/*/mytests -k | jq
{
  &#34;apiVersion&#34;: &#34;samina.fu.com/v1alpha1&#34;,
  &#34;items&#34;: [],
  &#34;kind&#34;: &#34;MyTestList&#34;,
  &#34;metadata&#34;: {
    &#34;continue&#34;: &#34;&#34;,
    &#34;resourceVersion&#34;: &#34;233252&#34;,
    &#34;selfLink&#34;: &#34;/apis/samina.fu.com/v1alpha1/namespaces/*/mytests&#34;
  }
}
</code></pre><h3 id="7-build-operator-container">7. Build operator container</h3>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>å¯ä»¥ä¾æ“š<a href="https://github.com/operator-framework/operator-sdk/blob/master/doc/helm/user-guide.md#1-run-as-a-pod-inside-a-kubernetes-cluster">å®˜æ–¹</a>æä¾›çš„ Build æ–¹å¼ <code>operator-sdk build registry_name/username/image_name:v0.0.1</code> + <code>docker push</code> ä¾†é€²è¡Œã€‚
ä¸é operator ç¶­è­·ä¸Šï¼Œæœ€å¥½å°ˆæ³¨åœ¨ operator çš„å®šç¾©ï¼Œè‡³æ–¼ build docker é€™ä»¶äº‹æƒ…å¯ä»¥äº¤çµ¦æ‡¶äººæ³• - dockerhub è‡ªå‹• Buildã€‚</p>
<p>eg.</p>
<p><img src="https://i.imgur.com/bNytZnq.png" alt=""></p>
<h3 id="8-åœ¨-k8s-ä¸­éƒ¨ç½²-operator">8. åœ¨ K8s ä¸­éƒ¨ç½² operator</h3>
<h4 id="1-ä¿®æ”¹-deployoperatoryaml-çš„-image-ä¾†æº">1. ä¿®æ”¹ <code>deploy/operator.yaml</code> çš„ image ä¾†æº</h4>
<pre tabindex="0"><code>sed -i &#39;s|REPLACE_IMAGE|repository/username/images_name:version|g&#39; deploy/operator.yaml
</code></pre><p>eg.</p>
<pre tabindex="0"><code>sed -i &#39;s|REPLACE_IMAGE|sufuf3/my-operator-test:latest|g&#39;  deploy/operator.yaml
</code></pre><h4 id="2-éƒ¨ç½²-operator">2. éƒ¨ç½² operator</h4>
<pre tabindex="0"><code>kubectl create -f deploy/service_account.yaml
kubectl create -f deploy/role.yaml
kubectl create -f deploy/role_binding.yaml
kubectl create -f deploy/operator.yaml
</code></pre><p>deploy å®Œå¾Œå°±å¯ä»¥çœ‹åˆ°æˆ‘å€‘çš„ operator æ˜¯ running çš„</p>
<pre tabindex="0"><code>$ kubectl get deploy,pod
NAME                                      DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deployment.extensions/play-k8s-operator   1         1         1            1           6m44s

NAME                                    READY   STATUS        RESTARTS   AGE
pod/play-k8s-operator-5c8fdc8fd-6m8tv   1/1     Running       0          6m44s
</code></pre><h3 id="9-åœ¨-k8s-ä¸­éƒ¨ç½²è‡ªå·±å®šç¾©çš„-custom-resource">9. åœ¨ K8s ä¸­éƒ¨ç½²è‡ªå·±å®šç¾©çš„ custom resource</h3>
<p>ç·¨è¼¯ <code>deploy/crds/GROUP_VERSION_CRDNAME_cr.yaml</code> å¾Œ deployã€‚</p>
<p>åœ¨æˆ‘æœªä¾†çš„å°ˆæ¡ˆè¨­è¨ˆæµç¨‹ä¸­ï¼Œæœƒæ˜¯éœ€è¦å…ˆè‡ªå·± create ä¸€å€‹ namespace å¾Œï¼Œå†ä¾æ“šå·²ç¶“å»ºç«‹çš„ namespace ï¼Œå»ºç«‹è‡ªå·±çš„ resourceã€‚<br>
ä»¥ä¸‹å°±ç°¡å–®çš„ä¾†ç”¨ default namespace éƒ¨ç½²ã€‚</p>
<!-- raw HTML omitted -->
<h4 id="1-ç·¨è¼¯-deploycrdsgroup_version_crdname_cryaml">1. ç·¨è¼¯ <code>deploy/crds/GROUP_VERSION_CRDNAME_cr.yaml</code></h4>
<p>spec åº•ä¸‹å°±æ˜¯è‡ªå·±å®šç¾©çš„ values ï¼Œåœ¨æˆ‘é€™å€‹ç·´ç¿’å°ˆæ¡ˆä¸­ï¼Œå®šç¾©å¦‚ä¸‹ï¼š</p>
<p><code>vim deploy/crds/samina_v1alpha1_mytest_cr.yaml</code></p>
<pre tabindex="0"><code>apiVersion: samina.fu.com/v1alpha1
kind: MyTest
metadata:
  name: example-mytest
spec:
  replicaCount: 1
  username: sufuf3
  containerName: mycontainer
  nameSpace: default
  image:
    repository: tensorflow/tensorflow
    tag: latest-jupyter
    pullPolicy: IfNotPresent
  nameOverride: &#34;&#34;
  fullnameOverride: &#34;&#34;
  service:
    type: NodePort
    port: 8888
    nodeport: 30566
  ingress:
    enabled: false
    annotations: {}
    paths: []
    hosts:
      - chart-example.local
    tls: []
  resources: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
</code></pre><h4 id="2-å»ºç«‹è‡ªå·±çš„-resource">2. å»ºç«‹è‡ªå·±çš„ resource</h4>
<pre tabindex="0"><code>kubectl create -f deploy/crds/samina_v1alpha1_mytest_cr.yaml
</code></pre><p>çµæœï¼š</p>
<pre tabindex="0"><code>$ kubectl get all -l app=mytest
NAME                                                           READY   STATUS    RESTARTS   AGE
pod/example-mytest-6bxnrell81eqsmdueqsqy7l7z-798dc58c8-g8q8q   1/1     Running   0          5m46s

NAME                                               TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
service/example-mytest-6bxnrell81eqsmdueqsqy7l7z   NodePort   10.103.245.94   &lt;none&gt;        8888:30567/TCP   5m46s

NAME                                                       DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/example-mytest-6bxnrell81eqsmdueqsqy7l7z   1         1         1            1           5m46s

NAME                                                                 DESIRED   CURRENT   READY   AGE
replicaset.apps/example-mytest-6bxnrell81eqsmdueqsqy7l7z-798dc58c8   1         1         1       5m46s
</code></pre><p>é€é API:</p>
<pre tabindex="0"><code>$ curl -s https://172.17.8.100:6443/apis/samina.fu.com/v1alpha1/namespaces/default/mytests/example-mytest -k | jq
</code></pre><h2 id="çµèª">çµèª</h2>
<p>æœ¬æ¬¡çš„ç·´ç¿’ GitHub repository åƒè€ƒé€£çµï¼šhttps://github.com/sufuf3/play-k8s-operator</p>
<p>é€™æ¨£é€é operator-framework/operator-sdk è¦å®Œæˆè‡ªå·±çš„ CRD å’Œ operator çœŸçš„å¾ˆå¿«é€Ÿèˆ‡æ–¹ä¾¿ï¼Œå¯ä»¥æƒ³è¦‹ï¼Œå¦‚æœæ˜¯ç¶­é‹äººå“¡ï¼Œäº†è§£éœ€æ±‚å¾Œï¼Œå¯ä»¥ä¸ç”¨å¯«å¾ˆå¤šçš„ operator ç¨‹å¼ï¼Œå°±å¯ä»¥å¿«é€Ÿéƒ¨ç½² operator çœŸçš„è »ä¾¿åˆ©çš„ã€‚ä¸”å¾ŒçºŒä¸€æ¨£å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨ K8s çš„ APIã€‚æ ¹æœ¬å°±æ˜¯æ‡¶äººæ•‘æ˜Ÿã€‚</p>
<p>ä¸éï¼Œæ˜¯å¦è¦ä½¿ç”¨ operator-framework/operator-sdk ï¼Œä¸€åˆ‡é‚„æ˜¯éœ€è¦è‡ªè¡Œçš„è©•ä¼°æ˜¯å¦åˆé©è‡ªå·±ï¼Œå°å¿ƒæœç”¨ã€‚</p>
<h2 id="åƒè€ƒé€£çµ">åƒè€ƒé€£çµ</h2>
<ul>
<li><a href="https://github.com/operator-framework/operator-sdk/blob/master/doc/helm/user-guide.md">https://github.com/operator-framework/operator-sdk/blob/master/doc/helm/user-guide.md</a></li>
<li><a href="https://github.com/operator-framework/operator-sdk/blob/master/doc/proposals/helm-operator.md">https://github.com/operator-framework/operator-sdk/blob/master/doc/proposals/helm-operator.md</a></li>
<li><a href="https://github.com/operator-framework/getting-started">https://github.com/operator-framework/getting-started</a></li>
</ul>


    </main>
  </div>
  <footer>
    <div class="footer-wrapper">
      <p>Made with â¤ï¸ &mdash; Powered by <a href="https://gohugo.io/" target="_blank" rel="external">Hugo</a> and the <a href="https://github.com/bjacquemet/personal-web" target='_blank' rel="external">Personal Web</a> theme.</p>
      <p>@Samina Fu</p>
    </div>
  </footer>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:500,600|Raleway:400,400i,600" rel="stylesheet">
  
  <script type="text/javascript">
    document.querySelector('.mobile-header').addEventListener('click', function () {
      var om = document.querySelector(".overlay-menu");
      if (document.querySelector('.hamburger').classList.contains("cross")) {
        document.querySelector('.hamburger').classList.remove("cross");
        om.style.display = "none";
        om.style.width = "0%";
        om.style.height = "0%";
      }
      else {
        document.querySelector('.hamburger').classList.add("cross");
        om.style.width = "100%";
        om.style.height = "80vh";
        om.style.display = "block";
      }
    });
  </script>
</body>
</html>
