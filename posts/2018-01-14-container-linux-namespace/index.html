<!DOCTYPE html>
<html lang='en'><head>
  <title>[Build container] Container with Linux Namespace - Samina Website</title>
  <link rel='canonical' href='https://bestsamina.github.io/posts/2018-01-14-container-linux-namespace/' />
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1' />
  <meta name='description' content='' />
  <meta name='theme-color' content='#D250F4' />
  
    <link rel="shortcut icon" href="/images/favicon.jpg" type="image/x-icon" />
    <link rel="icon" href="/images/favicon.jpg" type="image/x-icon" />
  

  <meta name="generator" content="Hugo 0.97.3" />

  





<link rel="stylesheet" href="https://bestsamina.github.io/sass/style.min.5a3cd6465e2d17087010765b79f4b67f107ff2a690781fbbfa18ece52420931b.css" integrity="sha256-WjzWRl4tFwhwEHZbefS2fxB/8qaQeB&#43;7&#43;hjs5SQgkxs=" media="screen">
<link rel="stylesheet" href="https://bestsamina.github.io/syntax.min.css" integrity="" media="screen">

  <meta property="og:title" content="[Build container] Container with Linux Namespace" />
<meta property="og:description" content="ç›®éŒ„ï¼š
 å‰è¨€ Linux Namespace é¡åˆ¥ The system calls of namespaces API UTS namespaces (CLONE_NEWUTS) IPC namespaces (CLONE_NEWIPC) PID namespaces (CLONE_NEWPID) Mount namespaces (CLONE_NEWNS) User namespaces (CLONE_NEWUSER) Network namespaces (CLONE_NEWNET)  å‰è¨€ Linux Namespace æ˜¯ Linux Kernel çš„å…¶ä¸­ä¸€å€‹åŠŸèƒ½ï¼Œå¯ä»¥éš”é›¢å°æ‡‰çš„ç³»çµ±è³‡æºã€‚ é—œæ–¼æ·±å…¥äº†è§£ Linux Namespace ï¼Œæœƒå†å¦é—¢ä¸€ç¯‡ä¾†æ¢è¨ã€‚ è€Œé€™é‚Šå°±å…ˆç…§è‘—é€²è¡Œï¼Œä¸éç‚ºäº†æƒ³æ³•ä¸Šèƒ½å¤ çŸ¥é“åœ¨åšä»€éº¼ï¼Œæˆ‘æ˜¯å¥—ç”¨ C&#43;&#43; çš„ Namespace æ¦‚å¿µä¾†å¹«åŠ©æˆ‘å…ˆé€²è¡Œå¯¦ä½œï¼Œè®“æˆ‘é€éå¯¦éš›çš„ç¨‹å¼èˆ‡æ“ä½œå¾Œï¼Œè€Œå°æ‡‰åˆ°åŸä¾†é€™å°±æ˜¯ Linux Namespace ä»¥åŠè¦æ€éº¼å¯¦ç¾ã€‚ PS. å»ºè­°æœ‰ä¸€é» OS æ¦‚å¿µè·Ÿè‘—åšæœƒæ¯”è¼ƒå¥½ï¼Œè¦ä¸ç„¶ï¼Œæœ€èµ·ç¢¼çŸ¥é“ PID æ˜¯ä»€éº¼ã€‚
å¯¦ä½œç’°å¢ƒæ‘˜è¦  Ubuntu 16.04 Kernel version: 4.13.0-1002-gcp Go version: v1.9.2 linux/amd64  Linux Namespace é¡åˆ¥ ä¾æ“š Linux Programmer&rsquo;s Manual çš„ Namespace æ–‡ä»¶ä¸­æåˆ° &ldquo;One use of namespaces is to implement containers." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bestsamina.github.io/posts/2018-01-14-container-linux-namespace/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-01-14T14:51:05+08:00" />
<meta property="article:modified_time" content="2018-01-14T14:51:05+08:00" />


  <meta itemprop="name" content="[Build container] Container with Linux Namespace">
<meta itemprop="description" content="ç›®éŒ„ï¼š
 å‰è¨€ Linux Namespace é¡åˆ¥ The system calls of namespaces API UTS namespaces (CLONE_NEWUTS) IPC namespaces (CLONE_NEWIPC) PID namespaces (CLONE_NEWPID) Mount namespaces (CLONE_NEWNS) User namespaces (CLONE_NEWUSER) Network namespaces (CLONE_NEWNET)  å‰è¨€ Linux Namespace æ˜¯ Linux Kernel çš„å…¶ä¸­ä¸€å€‹åŠŸèƒ½ï¼Œå¯ä»¥éš”é›¢å°æ‡‰çš„ç³»çµ±è³‡æºã€‚ é—œæ–¼æ·±å…¥äº†è§£ Linux Namespace ï¼Œæœƒå†å¦é—¢ä¸€ç¯‡ä¾†æ¢è¨ã€‚ è€Œé€™é‚Šå°±å…ˆç…§è‘—é€²è¡Œï¼Œä¸éç‚ºäº†æƒ³æ³•ä¸Šèƒ½å¤ çŸ¥é“åœ¨åšä»€éº¼ï¼Œæˆ‘æ˜¯å¥—ç”¨ C&#43;&#43; çš„ Namespace æ¦‚å¿µä¾†å¹«åŠ©æˆ‘å…ˆé€²è¡Œå¯¦ä½œï¼Œè®“æˆ‘é€éå¯¦éš›çš„ç¨‹å¼èˆ‡æ“ä½œå¾Œï¼Œè€Œå°æ‡‰åˆ°åŸä¾†é€™å°±æ˜¯ Linux Namespace ä»¥åŠè¦æ€éº¼å¯¦ç¾ã€‚ PS. å»ºè­°æœ‰ä¸€é» OS æ¦‚å¿µè·Ÿè‘—åšæœƒæ¯”è¼ƒå¥½ï¼Œè¦ä¸ç„¶ï¼Œæœ€èµ·ç¢¼çŸ¥é“ PID æ˜¯ä»€éº¼ã€‚
å¯¦ä½œç’°å¢ƒæ‘˜è¦  Ubuntu 16.04 Kernel version: 4.13.0-1002-gcp Go version: v1.9.2 linux/amd64  Linux Namespace é¡åˆ¥ ä¾æ“š Linux Programmer&rsquo;s Manual çš„ Namespace æ–‡ä»¶ä¸­æåˆ° &ldquo;One use of namespaces is to implement containers."><meta itemprop="datePublished" content="2018-01-14T14:51:05+08:00" />
<meta itemprop="dateModified" content="2018-01-14T14:51:05+08:00" />
<meta itemprop="wordCount" content="1232">
<meta itemprop="keywords" content="container,docker,Go,Linux," />
</head>
<body>

  <header style="background-image:linear-gradient(
      rgba(0,0,0,0.4),rgba(0,0,0,0.4)
    ),url(&#39;https://bestsamina.github.io/images/default-sidebar.jpg&#39;)">
  <div class="intro">
    <div class="logo-container">
      <a href="/">
        <img src='https://bestsamina.github.io/images/person.jpg' alt="Profile Stacer - ç³»çµ±å„ªåŒ–å™¨" class="rounded-logo">
      </a>
    </div>
    <h3>Hi, I'm Samina ğŸ‘‹</h3>
    <h4>This is my Life & Technological Journey</h4>
    <div class="menu">
      

        <p>
            <a href="/posts/">
                Post
            </a>
        </p>

        <p>
            <a href="/about/">
                About
            </a>
        </p>

        <p>
            <a href="/tags/">
                Tags
            </a>
        </p>

        <p>
            <a href="/categories/">
                Categories
            </a>
        </p>

        <p>
            <a href="/page/awesome-blogs/">
                Awesome-blogs
            </a>
        </p>

      
    </div>
  </div>

  <div class="socials">
      
  
    <a href="https://github.com/sufuf3" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M102.679 0H12.32C5.52 0 0 5.519 0 12.321v90.358C0 109.48 5.519 115 12.321 115h90.358c6.802 0 12.321-5.519 12.321-12.321V12.32C115 5.52 109.481 0 102.679 0zM71.182 98.494c-2.156.385-2.952-.95-2.952-2.053 0-1.386.051-8.471.051-14.195 0-4.005-1.335-6.546-2.9-7.881C74.878 73.313 84.89 72.003 84.89 55.6c0-4.671-1.669-7.007-4.39-10.01.436-1.105 1.9-5.648-.436-11.552-3.568-1.104-11.731 4.595-11.731 4.595-3.389-.95-7.06-1.438-10.679-1.438-3.62 0-7.29.488-10.679 1.438 0 0-8.163-5.699-11.73-4.595-2.337 5.878-.899 10.422-.437 11.551-2.72 3.004-4.004 5.34-4.004 10.011 0 16.326 9.574 17.712 19.072 18.765-1.232 1.104-2.336 3.003-2.72 5.724-2.44 1.104-8.677 3.004-12.4-3.568-2.335-4.056-6.545-4.39-6.545-4.39-4.159-.05-.282 2.619-.282 2.619 2.772 1.283 4.723 6.212 4.723 6.212 2.49 7.624 14.4 5.057 14.4 5.057 0 3.568.052 9.37.052 10.422 0 1.104-.77 2.438-2.952 2.053C27.21 92.821 15.35 76.701 15.35 57.86c0-23.564 18.02-41.456 41.585-41.456s42.663 17.892 42.663 41.456c.026 18.842-11.474 34.988-28.416 40.635zM46 82.81c-.488.103-.95-.102-1.001-.436-.051-.385.282-.719.77-.822.488-.05.95.154 1.001.488.077.334-.257.668-.77.77zm-2.439-.23c0 .333-.385.615-.898.615-.565.052-.95-.23-.95-.616 0-.333.385-.616.899-.616.487-.051.95.231.95.616zm-3.516-.283c-.103.334-.616.488-1.053.334-.488-.103-.821-.488-.719-.822.103-.334.617-.488 1.053-.385.513.154.847.54.719.873zm-3.158-1.386c-.23.282-.718.23-1.104-.154-.385-.334-.487-.822-.23-1.053.23-.282.718-.23 1.103.154.334.334.462.847.231 1.053zm-2.336-2.336c-.23.154-.667 0-.95-.385-.282-.385-.282-.822 0-1.001.283-.231.72-.052.95.333.283.385.283.847 0 1.053zm-1.668-2.49c-.231.23-.616.103-.899-.154-.282-.334-.333-.719-.102-.899.23-.23.616-.102.898.154.282.334.334.72.103.899zm-1.72-1.9c-.103.231-.436.283-.719.103-.334-.154-.488-.436-.385-.667.103-.154.385-.231.719-.103.334.18.488.462.385.667z"/>
  
  </svg>
</div>
</a>
  

  
    <a href="https://gitlab.com/sufuf3" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M23.76 5.544c-.693-1.991-3.512-1.991-4.228 0L6.892 44.653h29.532c-.022 0-12.663-39.11-12.663-39.11zM.426 64.34c-.582 1.79.067 3.782 1.589 4.923l55.464 41.167-50.61-65.778L.426 64.34zm35.977-19.688L57.5 110.43l21.098-65.778H36.402zm78.173 19.688l-6.444-19.688L57.5 110.43l55.464-41.167a4.475 4.475 0 0 0 1.61-4.923zM95.468 5.544c-.694-1.991-3.513-1.991-4.229 0L78.576 44.653h29.533L95.468 5.543z" />
  
  </svg>
</div>
</a>
  

  
    <a href="https://medium.com/@sufuf3149" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M0 0v115h115V0H0zm95.542 27.235l-6.16 5.905a1.81 1.81 0 0 0-.693 1.72v43.458c-.103.667.154 1.335.693 1.72l6.032 5.904v1.31h-30.29v-1.259l6.238-6.058c.616-.616.616-.795.616-1.72V43.074L54.625 87.123h-2.336l-20.202-44.05v29.52c-.18 1.233.257 2.49 1.13 3.39l8.111 9.83v1.31H18.277v-1.31l8.111-9.83a3.93 3.93 0 0 0 1.053-3.39v-34.14a2.93 2.93 0 0 0-.976-2.516l-7.213-8.702v-1.309h22.41l17.301 37.991 15.222-37.965h21.357v1.283z"/>
  
  </svg>
</div>
</a>
  

  
    <a href="https://twitter.com/sufuf3149" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M102.679 0H12.32C5.52 0 0 5.519 0 12.321v90.358C0 109.48 5.519 115 12.321 115h90.358c6.802 0 12.321-5.519 12.321-12.321V12.32C115 5.52 109.481 0 102.679 0zM90.126 40.763c.051.72.051 1.464.051 2.182 0 22.256-16.942 47.9-47.9 47.9-9.548 0-18.404-2.772-25.848-7.547 1.36.154 2.67.205 4.055.205 7.881 0 15.12-2.67 20.895-7.187-7.392-.154-13.604-5.006-15.735-11.68 2.593.385 4.929.385 7.598-.308a16.837 16.837 0 0 1-13.476-16.531v-.205a16.824 16.824 0 0 0 7.598 2.13 16.8 16.8 0 0 1-7.496-14.016c0-3.131.822-6.006 2.285-8.496a47.803 47.803 0 0 0 34.705 17.61c-2.387-11.424 6.161-20.69 16.429-20.69 4.851 0 9.215 2.027 12.296 5.313a32.99 32.99 0 0 0 10.678-4.056 16.792 16.792 0 0 1-7.393 9.267c3.389-.36 6.674-1.31 9.703-2.618a35.437 35.437 0 0 1-8.445 8.727z"/>
  
  </svg>
</div>
</a>
  

  </div>
</header>

<div class="mobile-header">
  <p> Samina Website </p>
  <div class="hamburger">
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
  </div>
</div>

<div class="overlay-menu">
  <header>
    <div class="intro">
      <div class="logo-container">
        <a href="/">
          <img src='https://bestsamina.github.io/images/person.jpg' alt="Profile Stacer - ç³»çµ±å„ªåŒ–å™¨" class="rounded-logo">
        </a>
      </div>
      <h3>Hi, I'm Samina ğŸ‘‹</h3>
      <h4>This is my Life & Technological Journey</h4>
      <div class="menu">
        

        <p>
            <a href="/posts/">
                Post
            </a>
        </p>

        <p>
            <a href="/about/">
                About
            </a>
        </p>

        <p>
            <a href="/tags/">
                Tags
            </a>
        </p>

        <p>
            <a href="/categories/">
                Categories
            </a>
        </p>

        <p>
            <a href="/page/awesome-blogs/">
                Awesome-blogs
            </a>
        </p>

        
      </div>
    </div>

    <div class="socials">
        
  
    <a href="https://github.com/sufuf3" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M102.679 0H12.32C5.52 0 0 5.519 0 12.321v90.358C0 109.48 5.519 115 12.321 115h90.358c6.802 0 12.321-5.519 12.321-12.321V12.32C115 5.52 109.481 0 102.679 0zM71.182 98.494c-2.156.385-2.952-.95-2.952-2.053 0-1.386.051-8.471.051-14.195 0-4.005-1.335-6.546-2.9-7.881C74.878 73.313 84.89 72.003 84.89 55.6c0-4.671-1.669-7.007-4.39-10.01.436-1.105 1.9-5.648-.436-11.552-3.568-1.104-11.731 4.595-11.731 4.595-3.389-.95-7.06-1.438-10.679-1.438-3.62 0-7.29.488-10.679 1.438 0 0-8.163-5.699-11.73-4.595-2.337 5.878-.899 10.422-.437 11.551-2.72 3.004-4.004 5.34-4.004 10.011 0 16.326 9.574 17.712 19.072 18.765-1.232 1.104-2.336 3.003-2.72 5.724-2.44 1.104-8.677 3.004-12.4-3.568-2.335-4.056-6.545-4.39-6.545-4.39-4.159-.05-.282 2.619-.282 2.619 2.772 1.283 4.723 6.212 4.723 6.212 2.49 7.624 14.4 5.057 14.4 5.057 0 3.568.052 9.37.052 10.422 0 1.104-.77 2.438-2.952 2.053C27.21 92.821 15.35 76.701 15.35 57.86c0-23.564 18.02-41.456 41.585-41.456s42.663 17.892 42.663 41.456c.026 18.842-11.474 34.988-28.416 40.635zM46 82.81c-.488.103-.95-.102-1.001-.436-.051-.385.282-.719.77-.822.488-.05.95.154 1.001.488.077.334-.257.668-.77.77zm-2.439-.23c0 .333-.385.615-.898.615-.565.052-.95-.23-.95-.616 0-.333.385-.616.899-.616.487-.051.95.231.95.616zm-3.516-.283c-.103.334-.616.488-1.053.334-.488-.103-.821-.488-.719-.822.103-.334.617-.488 1.053-.385.513.154.847.54.719.873zm-3.158-1.386c-.23.282-.718.23-1.104-.154-.385-.334-.487-.822-.23-1.053.23-.282.718-.23 1.103.154.334.334.462.847.231 1.053zm-2.336-2.336c-.23.154-.667 0-.95-.385-.282-.385-.282-.822 0-1.001.283-.231.72-.052.95.333.283.385.283.847 0 1.053zm-1.668-2.49c-.231.23-.616.103-.899-.154-.282-.334-.333-.719-.102-.899.23-.23.616-.102.898.154.282.334.334.72.103.899zm-1.72-1.9c-.103.231-.436.283-.719.103-.334-.154-.488-.436-.385-.667.103-.154.385-.231.719-.103.334.18.488.462.385.667z"/>
  
  </svg>
</div>
</a>
  

  
    <a href="https://gitlab.com/sufuf3" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M23.76 5.544c-.693-1.991-3.512-1.991-4.228 0L6.892 44.653h29.532c-.022 0-12.663-39.11-12.663-39.11zM.426 64.34c-.582 1.79.067 3.782 1.589 4.923l55.464 41.167-50.61-65.778L.426 64.34zm35.977-19.688L57.5 110.43l21.098-65.778H36.402zm78.173 19.688l-6.444-19.688L57.5 110.43l55.464-41.167a4.475 4.475 0 0 0 1.61-4.923zM95.468 5.544c-.694-1.991-3.513-1.991-4.229 0L78.576 44.653h29.533L95.468 5.543z" />
  
  </svg>
</div>
</a>
  

  
    <a href="https://medium.com/@sufuf3149" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M0 0v115h115V0H0zm95.542 27.235l-6.16 5.905a1.81 1.81 0 0 0-.693 1.72v43.458c-.103.667.154 1.335.693 1.72l6.032 5.904v1.31h-30.29v-1.259l6.238-6.058c.616-.616.616-.795.616-1.72V43.074L54.625 87.123h-2.336l-20.202-44.05v29.52c-.18 1.233.257 2.49 1.13 3.39l8.111 9.83v1.31H18.277v-1.31l8.111-9.83a3.93 3.93 0 0 0 1.053-3.39v-34.14a2.93 2.93 0 0 0-.976-2.516l-7.213-8.702v-1.309h22.41l17.301 37.991 15.222-37.965h21.357v1.283z"/>
  
  </svg>
</div>
</a>
  

  
    <a href="https://twitter.com/sufuf3149" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M102.679 0H12.32C5.52 0 0 5.519 0 12.321v90.358C0 109.48 5.519 115 12.321 115h90.358c6.802 0 12.321-5.519 12.321-12.321V12.32C115 5.52 109.481 0 102.679 0zM90.126 40.763c.051.72.051 1.464.051 2.182 0 22.256-16.942 47.9-47.9 47.9-9.548 0-18.404-2.772-25.848-7.547 1.36.154 2.67.205 4.055.205 7.881 0 15.12-2.67 20.895-7.187-7.392-.154-13.604-5.006-15.735-11.68 2.593.385 4.929.385 7.598-.308a16.837 16.837 0 0 1-13.476-16.531v-.205a16.824 16.824 0 0 0 7.598 2.13 16.8 16.8 0 0 1-7.496-14.016c0-3.131.822-6.006 2.285-8.496a47.803 47.803 0 0 0 34.705 17.61c-2.387-11.424 6.161-20.69 16.429-20.69 4.851 0 9.215 2.027 12.296 5.313a32.99 32.99 0 0 0 10.678-4.056 16.792 16.792 0 0 1-7.393 9.267c3.389-.36 6.674-1.31 9.703-2.618a35.437 35.437 0 0 1-8.445 8.727z"/>
  
  </svg>
</div>
</a>
  

    </div>
  </header>
</div>

  <div class="content-wrapper">
    
      <div class="breadcrumb">
  





<span >
  <a href="https://bestsamina.github.io/">Home</a>
   / 
</span>


<span >
  <a href="https://bestsamina.github.io/posts/">Posts</a>
   / 
</span>


<span  class="active">
  <a href="https://bestsamina.github.io/posts/2018-01-14-container-linux-namespace/">[Build container] Container with Linux Namespace</a>
  
</span>

</div>

    
    <main id="content" class="posts">

<h1>[Build container] Container with Linux Namespace</h1>


<span>
    Sunday, January 14, 2018
</span>
<br><br>

<ul id="tags">
  
    <li> <a href="https://bestsamina.github.io/tagscontainer">container</a> </li>
  
    <li> <a href="https://bestsamina.github.io/tagsdocker">docker</a> </li>
  
    <li> <a href="https://bestsamina.github.io/tagsgo">Go</a> </li>
  
    <li> <a href="https://bestsamina.github.io/tagslinux">Linux</a> </li>
  
</ul>


<span>
  <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#å¯¦ä½œç’°å¢ƒæ‘˜è¦">å¯¦ä½œç’°å¢ƒæ‘˜è¦</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#ä»‹ç´¹">ä»‹ç´¹</a></li>
        <li><a href="#å¯¦ä½œæµç¨‹">å¯¦ä½œæµç¨‹</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#ä»‹ç´¹-1">ä»‹ç´¹</a></li>
        <li><a href="#å¯¦ä½œæµç¨‹-1">å¯¦ä½œæµç¨‹</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#ä»‹ç´¹-2">ä»‹ç´¹</a></li>
        <li><a href="#å¯¦ä½œæµç¨‹-2">å¯¦ä½œæµç¨‹</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#ä»‹ç´¹-3">ä»‹ç´¹</a></li>
        <li><a href="#å¯¦ä½œæµç¨‹-3">å¯¦ä½œæµç¨‹</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#ä»‹ç´¹-4">ä»‹ç´¹</a></li>
        <li><a href="#å¯¦ä½œæµç¨‹-4">å¯¦ä½œæµç¨‹</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#ä»‹ç´¹-5">ä»‹ç´¹</a></li>
        <li><a href="#å¯¦ä½œæµç¨‹-5">å¯¦ä½œæµç¨‹</a></li>
        <li><a href="#ç›¸é—œç³»åˆ—æ–‡">ç›¸é—œç³»åˆ—æ–‡ï¼š</a></li>
      </ul>
    </li>
  </ul>
</nav>
</span>

<p>ç›®éŒ„ï¼š</p>
<ul>
<li>å‰è¨€</li>
<li>Linux Namespace é¡åˆ¥</li>
<li>The system calls of namespaces API</li>
<li>UTS namespaces (CLONE_NEWUTS)</li>
<li>IPC namespaces (CLONE_NEWIPC)</li>
<li>PID namespaces (CLONE_NEWPID)</li>
<li>Mount namespaces (CLONE_NEWNS)</li>
<li>User namespaces (CLONE_NEWUSER)</li>
<li>Network namespaces (CLONE_NEWNET)</li>
</ul>
<h1 id="å‰è¨€">å‰è¨€</h1>
<p>Linux Namespace æ˜¯ Linux Kernel çš„å…¶ä¸­ä¸€å€‹åŠŸèƒ½ï¼Œå¯ä»¥éš”é›¢å°æ‡‰çš„ç³»çµ±è³‡æºã€‚
é—œæ–¼æ·±å…¥äº†è§£ Linux Namespace ï¼Œæœƒå†å¦é—¢ä¸€ç¯‡ä¾†æ¢è¨ã€‚
è€Œé€™é‚Šå°±å…ˆç…§è‘—é€²è¡Œï¼Œä¸éç‚ºäº†æƒ³æ³•ä¸Šèƒ½å¤ çŸ¥é“åœ¨åšä»€éº¼ï¼Œæˆ‘æ˜¯å¥—ç”¨ C++ çš„ Namespace æ¦‚å¿µä¾†å¹«åŠ©æˆ‘å…ˆé€²è¡Œå¯¦ä½œï¼Œè®“æˆ‘é€éå¯¦éš›çš„ç¨‹å¼èˆ‡æ“ä½œå¾Œï¼Œè€Œå°æ‡‰åˆ°åŸä¾†é€™å°±æ˜¯ Linux Namespace ä»¥åŠè¦æ€éº¼å¯¦ç¾ã€‚
PS. å»ºè­°æœ‰ä¸€é» OS æ¦‚å¿µè·Ÿè‘—åšæœƒæ¯”è¼ƒå¥½ï¼Œè¦ä¸ç„¶ï¼Œæœ€èµ·ç¢¼çŸ¥é“ PID æ˜¯ä»€éº¼ã€‚</p>
<h3 id="å¯¦ä½œç’°å¢ƒæ‘˜è¦">å¯¦ä½œç’°å¢ƒæ‘˜è¦</h3>
<ul>
<li>Ubuntu 16.04</li>
<li>Kernel version: 4.13.0-1002-gcp</li>
<li>Go version: v1.9.2 linux/amd64</li>
</ul>
<h1 id="linux-namespace-é¡åˆ¥">Linux Namespace é¡åˆ¥</h1>
<p>ä¾æ“š Linux Programmer&rsquo;s Manual çš„ <a href="http://man7.org/linux/man-pages/man7/namespaces.7.html">Namespace</a> æ–‡ä»¶ä¸­æåˆ° &ldquo;One use of namespaces is to implement containers.&quot;ã€‚æ‰€ä»¥ç•¶ç„¶è¦ä¾†çŸ¥é“ Linux æä¾›å“ªäº› namespaces å›‰ï¼<br>
ä¸»è¦åˆ†ç‚ºä»¥ä¸‹ 7 é¡ï¼Œé€™é‚Šé™¤äº† Cgroup æœƒå¦å¤–æ¢è¨å¤–ï¼Œå…¶ä»–çš„å…­ç¨®æœƒåœ¨é€™é‚Šä¾†ç·´ç¿’å¯¦åšã€‚</p>
<pre tabindex="0"><code>       Namespace   Constant          Isolates
       Cgroup      CLONE_NEWCGROUP   Cgroup root directory
       IPC         CLONE_NEWIPC      System V IPC, POSIX message queues
       Network     CLONE_NEWNET      Network devices, stacks, ports, etc.
       Mount       CLONE_NEWNS       Mount points
       PID         CLONE_NEWPID      Process IDs
       User        CLONE_NEWUSER     User and group IDs
       UTS         CLONE_NEWUTS      Hostname and NIS domain name
</code></pre><h1 id="the-system-calls-of-namespaces-api">The system calls of namespaces API</h1>
<ul>
<li>clone(): å‰µå»ºæ–°çš„ process ã€‚ç•¶ flag çš„åƒæ•¸åŒ…å«ä¸€å€‹æˆ–å¤šå€‹ CLONE_NEW* çš„ flagsï¼Œchild process æœƒè¢«åŒ…å«åœ¨æ–°çš„ namespace ä¸­ã€‚</li>
<li>setns(): å…è¨± calling process åŠ å…¥ç¾æœ‰çš„ namespaceã€‚</li>
<li>unshare(): å°‡ calling process ç§»åˆ°æ–°çš„ namespaceã€‚</li>
</ul>
<h1 id="uts-namespaces-clone_newuts">UTS namespaces (CLONE_NEWUTS)</h1>
<h3 id="ä»‹ç´¹">ä»‹ç´¹</h3>
<p>éš”é›¢ hostname å’Œ NIS domain name å…©å€‹ç³»çµ± identifiersã€‚é€™äº› identifiers å¯ä½¿ç”¨ sethostname() å’Œ setdomainname() ä¾†è¨­å®šï¼Œä¸¦ä¸”ä½¿ç”¨ uname(), gethostname() å’Œ getdomainname() ä¾†æŸ¥è©¢ã€‚</p>
<p>Memo: <code>UTS = UNIX Time-sharing System</code> (ref: <a href="https://lwn.net/Articles/531114/">https://lwn.net/Articles/531114/</a>)</p>
<h3 id="å¯¦ä½œæµç¨‹">å¯¦ä½œæµç¨‹</h3>
<h4 id="step-1-æ’°å¯«ç¨‹å¼">Step 1. æ’°å¯«ç¨‹å¼</h4>
<p>ä½¿ç”¨  namespace API çš„ clone() ä¾†å‰µå»ºä¸€å€‹æ–°çš„ process ä¸¦é€é CLONE_NEWUTS flag ä¾†å‰µå»ºä¸€å€‹ UTS namespace ã€‚å‰µå»ºå¥½ namespace ä¹‹å¾Œï¼Œé€²å…¥ sh (Go lang ç¯„ä¾‹ç¨‹å¼)æˆ– bash (C ç¯„ä¾‹ç¨‹å¼) ç’°å¢ƒã€‚</p>
<ul>
<li>Go lang: <a href="https://github.com/sufuf3/mygo-container/blob/master/namespace/uts.go">https://github.com/sufuf3/mygo-container/blob/master/namespace/uts.go</a></li>
<li>C lang: <a href="https://github.com/sufuf3/myc-container/blob/master/namespace/uts.c">https://github.com/sufuf3/myc-container/blob/master/namespace/uts.c</a></li>
</ul>
<h4 id="step-2-åŸ·è¡Œç¨‹å¼">Step 2. åŸ·è¡Œç¨‹å¼</h4>
<ul>
<li>Go lang: <code>sudo go run uts.go</code></li>
<li>C lang: <code>gcc uts.c -o uts.o</code> -&gt; <code>sudo ./uts.o</code></li>
</ul>
<h4 id="step-3-è§€å¯Ÿ">Step 3. è§€å¯Ÿ</h4>
<p>1. é–‹å¦å¤–ä¸€å€‹ terminal (æˆ–æ˜¯ä½¿ç”¨ tumx ç­‰å·¥å…·åˆ‡åˆ°æ–°çš„è¦–çª—ä¹Ÿæ˜¯å¯ä»¥)ï¼Œå…ˆä¾†çœ‹çœ‹åœ¨ host æœ¬èº«çš„ process ï¼Œé€™é‚Šä½¿ç”¨ pstree ä¾†å°‡ process çš„é—œä¿‚ä½¿ç”¨æ¨¹ç‹€åœ–ä¾†å‘ˆç¾ï¼ŒæŒ‡ä»¤æˆ‘å€‘ä¸‹ <code>pstree -pl</code> (-p ç‚º é¡¯ç¤º pid, -l æ˜¯ä¸è¦å°‡é•·çš„é‚£ä¸€è¡Œæˆªæ–·)ã€‚æœƒå–å¾—åº•ä¸‹é¡ä¼¼çš„å…§å®¹</p>
<pre tabindex="0"><code>$ pstree -pl
â”€bash(5940)â”€â”€â”€sudo(9098)â”€â”€â”€go(9099)â”€â”¬â”€uts(9117)â”€â”¬â”€sh(9121)
                                    â”‚           â”œâ”€{uts}(9119)
                                    â”‚           â””â”€{uts}(9120)
</code></pre><p>2. ç„¶å¾Œå›åˆ°æˆ‘å€‘ç¨‹å¼é€²åˆ°çš„ sh ç’°å¢ƒä¸‹ <code>echo $$</code></p>
<pre tabindex="0"><code># echo $$
9121
</code></pre><p>æœƒç™¼ç¾æˆ‘å€‘ç¨‹å¼ç›®å‰çš„ PID æ˜¯ 9121ã€‚</p>
<ol start="3">
<li>ä¾†ç¢ºèªç¨‹å¼çš„ namespace type å’Œ inode number ï¼Œé€™é‚Šæˆ‘å€‘ä½¿ç”¨ä¸‹é¢çš„é©—è­‰æ–¹æ³• (è©³ç´°å¯ä»¥åˆ° <a href="http://man7.org/linux/man-pages/man7/namespaces.7.html">http://man7.org/linux/man-pages/man7/namespaces.7.html</a> )</li>
</ol>
<pre tabindex="0"><code># readlink /proc/$$/ns/uts
uts:[4026532211]
# readlink /proc/9121/ns/uts
uts:[4026532211]
# readlink /proc/9117/ns/uts
uts:[4026531838]
</code></pre><p>é€™é‚Šæˆ‘å€‘çŸ¥é“å­ process å’Œçˆ¶ process çš„ inode number æ˜¯ä¸åŒçš„ï¼Œä¹Ÿç¢ºèªæ˜¯ä»–å€‘æ˜¯ä¸åŒçš„ UTS namespaceã€‚(å› ç‚ºåœ¨ Linux 3.8 å¾Œï¼Œé€™äº›æª”æ¡ˆä½¿ç”¨ symbolic linksï¼Œæ‰€ä»¥å¦‚æœå…©å€‹ processes éƒ½åœ¨åŒä¸€å€‹ namespaceï¼Œé‚£éº¼ä»–å€‘çš„ inode numbers éƒ½æœƒæ˜¯ä¸€æ¨£çš„)</p>
<p>4. ä¾†é€éç¨‹å¼æ”¹ hostname çœ‹çœ‹æ˜¯å¦çœŸçš„æœƒæ”¹åˆ° host çš„ hostnameã€‚</p>
<pre tabindex="0"><code># hostname -b mylittlecontainer
# hostname
mylittlecontainer
</code></pre><p>ç­”æ¡ˆç•¶æ™‚æ˜¯æ²’æ³•æ”¹åˆ°å›‰ï¼æ‰€ä»¥ç¬¬ä¸€æ­¥ UTS namespace éš”é›¢æˆåŠŸã€‚å› ç‚º host çš„ hostname è¨­å®šç„¡æ³•è¢«ç¨‹å¼å…§éƒ¨å½±éŸ¿åˆ°ã€‚</p>
<h1 id="ipc-namespaces-clone_newipc">IPC namespaces (CLONE_NEWIPC)</h1>
<h3 id="ä»‹ç´¹-1">ä»‹ç´¹</h3>
<p>éš”é›¢ IPC resources, namely, System V IPC objects å’Œ POSIX message queuesã€‚
Memo: <code>IPC = interprocess communication</code> (ref: <a href="http://ggav8d.blogspot.tw/2012/10/linux-linux-ipc.html">http://ggav8d.blogspot.tw/2012/10/linux-linux-ipc.html</a>)</p>
<blockquote>
<p>è©²æ‰¾æ™‚é–“å…¨é¢ç†è§£ IPC äº† QQ ï¼Œæˆ‘å° IPC çš„è§€å¿µä¸¦æ²’æœ‰èæœƒè²«é€šï¼Œé€™é‚Šå°±æ˜¯ç…§è‘—åšçš„æ¦‚å¿µäº†ã€‚ å¹¸å¥½ï¼Œé‚„ç®—çŸ¥é“ä»€éº¼æ˜¯ semaphore, message queue, pipe, share memoryã€‚QQ</p>
</blockquote>
<h3 id="å¯¦ä½œæµç¨‹-1">å¯¦ä½œæµç¨‹</h3>
<h4 id="step-1-æ’°å¯«ç¨‹å¼-1">Step 1. æ’°å¯«ç¨‹å¼</h4>
<p>ä½¿ç”¨  namespace API çš„ clone() ä¾†å‰µå»ºä¸€å€‹æ–°çš„ process ä¸¦é€é CLONE_NEWUTS å’Œ CLONE_NEWIPC flags ä¾†å‰µå»º namespace ã€‚å‰µå»ºå¥½ namespace ä¹‹å¾Œï¼Œé€²å…¥ sh (Go lang ç¯„ä¾‹ç¨‹å¼)æˆ– bash (C ç¯„ä¾‹ç¨‹å¼) ç’°å¢ƒã€‚ (å…¶å¯¦æ˜¯ UTS çš„ç¨‹å¼ç¢¼å†æ”¹å‹•ä¸€é»é»è€Œå·²)</p>
<ul>
<li>Go lang: <a href="https://github.com/sufuf3/mygo-container/blob/master/namespace/ipc.go">https://github.com/sufuf3/mygo-container/blob/master/namespace/ipc.go</a></li>
<li>C lang: <a href="https://github.com/sufuf3/myc-container/blob/master/namespace/ipc.c">https://github.com/sufuf3/myc-container/blob/master/namespace/ipc.c</a></li>
</ul>
<h4 id="step-2-åŸ·è¡Œç¨‹å¼-1">Step 2. åŸ·è¡Œç¨‹å¼</h4>
<ul>
<li>Go lang: <code>sudo go run ipc.go</code></li>
<li>C lang: <code>gcc ipc.c -o ipc.o</code> -&gt; <code>sudo ./ipc.o</code></li>
</ul>
<h4 id="step-3-è§€å¯Ÿ-1">Step 3. è§€å¯Ÿ</h4>
<p>åœ¨ç¬¬ä¸€æ¬¡çš„ namespace ä¸­åœ¨å‰µå»ºä¸€å€‹æ–°çš„ namespace å¯ä»¥çœ‹åˆ°åœ¨æ–°çš„ namespace ä¸­çš„ message queue æ²’æœ‰åŸæœ¬ namespace çš„ message queue ï¼Œå¯ä»¥çŸ¥é“ IPC å·²å®Œå…¨è¢«éš”é›¢ã€‚</p>
<ul>
<li>Memo:
<ol>
<li>ipcs æŸ¥è¯¢ process é€šè¨Šçš„ç‹€æ…‹</li>
<li>ipcmk - make various IPC resources
(ref: <a href="http://man7.org/linux/man-pages/man1/ipcmk.1.html">http://man7.org/linux/man-pages/man1/ipcmk.1.html</a>)</li>
</ol>
</li>
</ul>
<pre tabindex="0"><code>$ sudo go run ipc.go
# readlink /proc/$$/ns/uts /proc/$$/ns/ipc
uts:[4026532211]
ipc:[4026532212]
# ipcs -q

------ Message Queues --------
key        msqid      owner      perms      used-bytes   messages

# ipcmk -Q
Message queue id: 0
# ipcs -q

------ Message Queues --------
key        msqid      owner      perms      used-bytes   messages
0x4364496c 0          root       644        0            0

# go run ipc.go
# ipcs -q

------ Message Queues --------
key        msqid      owner      perms      used-bytes   messages
</code></pre><h1 id="pid-namespaces-clone_newpid">PID namespaces (CLONE_NEWPID)</h1>
<h3 id="ä»‹ç´¹-2">ä»‹ç´¹</h3>
<p>éš”é›¢ process ID number ç©ºé–“ã€‚å°±æ˜¯åŒå€‹ processes åœ¨ä¸åŒçš„ PID namespace å¯ä»¥é¡¯ç¤ºä¸ä¸€æ¨£çš„ PIDã€‚ PID namespace å¯ä»¥è®“ container æä¾›æš«åœ/æ¢å¾© container çš„ process ä»¥åŠè½‰ç§» container åˆ°å¦å¤–çš„ host ä¸Šã€‚PIDs åœ¨ æ–°çš„  PID namespace é–‹å§‹éƒ½æ˜¯ä½¿ç”¨ 1ã€‚ (å¦‚æœæœ‰åœ¨ docker è£¡é¢ä½¿ç”¨ ps æœƒäº†è§£åˆ°é€™éƒ¨åˆ†ã€‚)</p>
<h3 id="å¯¦ä½œæµç¨‹-2">å¯¦ä½œæµç¨‹</h3>
<h4 id="step-1-æ’°å¯«ç¨‹å¼-2">Step 1. æ’°å¯«ç¨‹å¼</h4>
<p>ä½¿ç”¨  namespace API çš„ clone() ä¾†å‰µå»ºä¸€å€‹æ–°çš„ process ä¸¦é€é CLONE_NEWPID flag ä¾†å‰µå»º namespace ã€‚å‰µå»ºå¥½ namespace ä¹‹å¾Œï¼Œé€²å…¥ sh (Go lang ç¯„ä¾‹ç¨‹å¼)æˆ– bash (C ç¯„ä¾‹ç¨‹å¼) ç’°å¢ƒã€‚ (ä¸€æ¨£æ˜¯ä¸Šé¢å†æ”¹ä¸€é»é»ï¼Œå¾Œé¢é€™éƒ¨åˆ†å°±åƒ…é™„ä¸Šç¨‹å¼ç¢¼ï¼Œä¸æœƒå†åšèªªæ˜ã€‚)</p>
<ul>
<li>Go lang: <a href="https://github.com/sufuf3/mygo-container/blob/master/namespace/pid.go">https://github.com/sufuf3/mygo-container/blob/master/namespace/pid.go</a></li>
<li>C lang: <a href="https://github.com/sufuf3/myc-container/blob/master/namespace/pid.c">https://github.com/sufuf3/myc-container/blob/master/namespace/pid.c</a></li>
</ul>
<h4 id="step-2-åŸ·è¡Œç¨‹å¼-2">Step 2. åŸ·è¡Œç¨‹å¼</h4>
<ul>
<li>Go lang: <code>sudo go run pid.go</code></li>
<li>C lang: <code>gcc pid.c -o pid.o</code> -&gt; <code>sudo ./pid.o</code></li>
</ul>
<h4 id="step-3-è§€å¯Ÿ-2">Step 3. è§€å¯Ÿ</h4>
<p>1. å…ˆä¾†çœ‹çœ‹åœ¨ host ä¸Šçš„ pstree</p>
<pre tabindex="0"><code>â”€bash(5940)â”€â”€â”€sudo(18717)â”€â”€â”€go(18718)â”€â”¬â”€pid(18736)â”€â”¬â”€sh(18740)
                                      â”‚            â”œâ”€{pid}(18738)
                                      â”‚            â””â”€{pid}(18739)
                                      â”œâ”€{go}(18719)
                                      â”œâ”€{go}(18720)
                                      â”œâ”€{go}(18721)
                                      â”œâ”€{go}(18726)
                                      â”œâ”€{go}(18737)
                                      â””â”€{go}(18741)
</code></pre><p>2. å°±æˆ‘å€‘ä¸Šé¢çš„ UTS namespace æ‰€çŸ¥ï¼Œå¯¦éš›ä¸Šåœ¨ host çš„ PID æ˜¯ 18736ï¼Œä¸éç•¶æˆ‘å€‘åœ¨ç¨‹å¼çš„ sh ç’°å¢ƒè£¡ä½¿ç”¨ <code>echo $$</code> æˆ‘å€‘å¾—åˆ°çš„ PID ç‚º 1</p>
<pre tabindex="0"><code>$ sudo go run pid.go
# echo $$
1
</code></pre><blockquote>
<p>æƒ³è¦åœ¨ç¨‹å¼çš„ sh ç’°å¢ƒä¸­ä½¿ç”¨ ps æŒ‡ä»¤çš„è©±ï¼Œå°±è®“ç¹¼çºŒå¾€å¾Œé€²è¡Œå›‰ï¼åˆ°é€™é‚Šè »èˆˆå¥®çš„ï¼Œå› ç‚ºå¥½åƒé–‹å§‹çœ‹åˆ°ä¸€é»é» docker çš„å½±å­äº†å‘¢ï¼</p>
</blockquote>
<h1 id="mount-namespaces-clone_newns">Mount namespaces (CLONE_NEWNS)</h1>
<h3 id="ä»‹ç´¹-3">ä»‹ç´¹</h3>
<p>åœ¨æ¯å€‹ namespace instance éš”é›¢ processes çš„ list of mount pointsã€‚é€é <code>/proc/[pid]/mounts</code>, <code>/proc/[pid]/mountinfo</code>, <code>/proc/[pid]/mountstats</code> ä¾†æä¾› viewsã€‚</p>
<h3 id="å¯¦ä½œæµç¨‹-3">å¯¦ä½œæµç¨‹</h3>
<h4 id="step-1-æ’°å¯«ç¨‹å¼-3">Step 1. æ’°å¯«ç¨‹å¼</h4>
<p>ä¸€æ¨£åªæ”¹ä¸€é»é»éƒ¨åˆ†ã€‚</p>
<ul>
<li>Go lang: <a href="https://github.com/sufuf3/mygo-container/blob/master/namespace/mount.go">https://github.com/sufuf3/mygo-container/blob/master/namespace/mount.go</a></li>
<li>C lang: <a href="https://github.com/sufuf3/myc-container/blob/master/namespace/mount.c">https://github.com/sufuf3/myc-container/blob/master/namespace/mount.c</a></li>
</ul>
<h4 id="step-2-åŸ·è¡Œç¨‹å¼-3">Step 2. åŸ·è¡Œç¨‹å¼</h4>
<ul>
<li>Go lang: <code>sudo go run mount.go</code></li>
<li>C lang: <code>gcc mount.c -o mount.o</code> -&gt; <code>sudo ./mount.o</code></li>
</ul>
<h4 id="step-3-è§€å¯Ÿ-3">Step 3. è§€å¯Ÿ</h4>
<p>1. ç¬¬ä¸€æ¬¡çš„ <code>ls /proc</code> çœ‹åˆ°çš„æ˜¯ host çš„ /proc</p>
<pre tabindex="0"><code>$ sudo go run mount.go 
# ls /proc
1     1244   14030  18395  2      27   409   6022  92         driver       key-users    mtrr          sys
10    1245   1483   18396  20     276  410   6722  acpi       execdomains  kmsg         net           sysrq-trigger
1067  1250   15     18397  20008  28   411   7     buddyinfo  fb           kpagecgroup  pagetypeinfo  sysvipc
11    13     1580   18458  20026  32   412   76    bus        filesystems  kpagecount   partitions    thread-self
1104  1365   15915  19     2015   327  413   77    cgroups    fs           kpageflags   sched_debug   timer_list
1105  13788  16     19184  2016   328  414   78    cmdline    interrupts   loadavg      schedstat     tty
1111  13789  1645   19762  21     33   452   79    consoles   iomem        locks        scsi          uptime
112   13930  1660   19810  22     34   456   8     cpuinfo    ioports      mdstat       self          version
1130  1394   17     19811  23     4    5773  8259  crypto     irq          meminfo      slabinfo      version_signature
1155  14     18     19830  24     403  5939  85    devices    kallsyms     misc         softirqs      vmallocinfo
12    14025  18088  19833  25     406  5940  895   diskstats  kcore        modules      stat          vmstat
1228  14026  18304  19841  26     408  6     9     dma        keys         mounts       swaps         zoneinfo
</code></pre><p>2. ç‚ºäº†çœ‹åˆ° Mount namespace çš„ /proc ï¼Œæˆ‘å€‘å°‡ /proc mount åˆ° namespace åº•ä¸‹ã€‚ç„¶å¾Œå†ä¾†è§€å¯Ÿ <code>ls /proc</code>ã€‚é€™é‚Šæœƒç™¼ç¾åªæœ‰é¡¯ç¤º namespace åº•ä¸‹çš„æª”æ¡ˆã€‚</p>
<pre tabindex="0"><code># mount -t proc proc /proc
# ls /proc
1          consoles   execdomains  irq          kpagecount  modules       schedstat  sys            version
4          cpuinfo    fb           kallsyms     kpageflags  mounts        scsi       sysrq-trigger  version_signature
acpi       crypto     filesystems  kcore        loadavg     mtrr          self       sysvipc        vmallocinfo
buddyinfo  devices    fs           keys         locks       net           slabinfo   thread-self    vmstat
bus        diskstats  interrupts   key-users    mdstat      pagetypeinfo  softirqs   timer_list     zoneinfo
cgroups    dma        iomem        kmsg         meminfo     partitions    stat       tty
cmdline    driver     ioports      kpagecgroup  misc        sched_debug   swaps      uptime
</code></pre><p>3. å†ä¾†æˆ‘å€‘ä½¿ç”¨ <code>ps -ef</code> å°±å¯ä»¥çœ‹åˆ°æˆ‘å€‘ namespace è£¡é¢çš„ process æ‹‰ï¼</p>
<pre tabindex="0"><code># ps -ef
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 10:20 pts/1    00:00:00 sh
root         5     1  0 10:21 pts/1    00:00:00 ps -ef
</code></pre><h1 id="user-namespaces-clone_newuser">User namespaces (CLONE_NEWUSER)</h1>
<h3 id="ä»‹ç´¹-4">ä»‹ç´¹</h3>
<p>éš”é›¢ security-related identifiers å’Œ attributesï¼Œå°¤å…¶æ˜¯ä¸€å€‹ process çš„ user IDs å’Œ group IDs æ˜¯å¯ä»¥å…§å¤–ä¸åŒçš„ã€‚ä¹Ÿå°±æ˜¯åœ¨ host ä¸Šé¢å¯ä»¥ç”¨é root çš„ä½¿ç”¨è€…ï¼Œä½†åˆ° namespace è£¡é¢è©²ä½¿ç”¨è€…å¯ä»¥åœ¨ namespace æˆç‚º root ã€‚</p>
<h3 id="å¯¦ä½œæµç¨‹-4">å¯¦ä½œæµç¨‹</h3>
<h4 id="step-1-æ’°å¯«ç¨‹å¼-4">Step 1. æ’°å¯«ç¨‹å¼</h4>
<p>ä¸€æ¨£æ”¹ä¸€é»é»çš„ç¨‹å¼ã€‚</p>
<ul>
<li>Go lang: <a href="https://github.com/sufuf3/mygo-container/blob/master/namespace/user.go">https://github.com/sufuf3/mygo-container/blob/master/namespace/user.go</a></li>
<li>C lang: <a href="https://github.com/sufuf3/myc-container/blob/master/namespace/user.c">https://github.com/sufuf3/myc-container/blob/master/namespace/user.c</a></li>
</ul>
<h4 id="step-2-åŸ·è¡Œç¨‹å¼-4">Step 2. åŸ·è¡Œç¨‹å¼</h4>
<ul>
<li>Go lang: <code>sudo go run user.go</code></li>
<li>C lang: <code>gcc user.c -o user.o</code> -&gt; <code>sudo ./user.o</code></li>
</ul>
<h4 id="step-3-è§€å¯Ÿ-4">Step 3. è§€å¯Ÿ</h4>
<p>1. é¦–å…ˆåœ¨æœ¬æ©ŸæŸ¥ user ID.</p>
<pre tabindex="0"><code>$ sudo id
uid=0(root) gid=0(root) groups=0(root)
</code></pre><p>2. ç„¶å¾ŒåŸ·è¡Œç¨‹å¼é€²åˆ° sh è£¡é¢æŸ¥çœ‹ id</p>
<pre tabindex="0"><code>$ sudo go run user.go 

$ id
uid=65534(nobody) gid=65534(nogroup) groups=65534(nogroup)
</code></pre><p>å¯ä»¥çœ‹åˆ°ä¸åŒçš„ UID ï¼Œæ‰€ä»¥ User namespace æˆåŠŸéš”é›¢äº†ã€‚</p>
<h1 id="network-namespaces-clone_newnet">Network namespaces (CLONE_NEWNET)</h1>
<h3 id="ä»‹ç´¹-5">ä»‹ç´¹</h3>
<p>éš”é›¢ host æœ¬èº«çš„ networking è³‡æºï¼Œå¦‚ï¼šnetwork devices, IPv4 and IPv6 protocol stacks, IP routing tables, firewalls, the /proc/net directory, the /sys/class/net directory, port numbers (sockets) &hellip;.</p>
<h3 id="å¯¦ä½œæµç¨‹-5">å¯¦ä½œæµç¨‹</h3>
<h4 id="step-1-æ’°å¯«ç¨‹å¼-5">Step 1. æ’°å¯«ç¨‹å¼</h4>
<p>ä¸€æ¨£æ”¹ä¸€é»é»çš„ç¨‹å¼ã€‚</p>
<ul>
<li>Go lang: <a href="https://github.com/sufuf3/mygo-container/blob/master/namespace/net.go">https://github.com/sufuf3/mygo-container/blob/master/namespace/net.go</a></li>
<li>C lang: <a href="https://github.com/sufuf3/myc-container/blob/master/namespace/net.c">https://github.com/sufuf3/myc-container/blob/master/namespace/net.c</a></li>
</ul>
<h4 id="step-2-åŸ·è¡Œç¨‹å¼-5">Step 2. åŸ·è¡Œç¨‹å¼</h4>
<ul>
<li>Go lang: <code>sudo go run net.go</code></li>
<li>C lang: <code>gcc net.c -o net.o</code> -&gt; <code>sudo ./net.o</code></li>
</ul>
<h4 id="step-3-è§€å¯Ÿ-5">Step 3. è§€å¯Ÿ</h4>
<pre tabindex="0"><code>$ sudo go run net.go

$ ifconfig
Warning: cannot open /proc/net/dev (No such file or directory). Limited output.
</code></pre><p>ç”±ä¸Šå¯çŸ¥ï¼ŒåŸæœ¬ host ä¸Šçš„ ifconfig æœ‰å¾ˆå¤š Network çš„è³‡è¨Šï¼Œä½†é€²åˆ° namespace è£¡é¢ï¼Œä»€éº¼éƒ½æ²’çœ‹åˆ°ï¼Œæ‰€ä»¥å°±æ˜¯éš”é›¢ç¶²è·¯äº†ã€‚</p>
<p>Ref:</p>
<ol>
<li><a href="https://yq.aliyun.com/articles/64928">https://yq.aliyun.com/articles/64928</a></li>
<li><a href="https://lwn.net/Articles/531114/">https://lwn.net/Articles/531114/</a></li>
<li><a href="http://blog.lucode.net/linux/intro-Linux-namespace-1.html">http://blog.lucode.net/linux/intro-Linux-namespace-1.html</a></li>
</ol>
<h3 id="ç›¸é—œç³»åˆ—æ–‡">ç›¸é—œç³»åˆ—æ–‡ï¼š</h3>
<p><a href="/series/my-own-container">[Build container] è‡ªå·±çš„ Container è‡ªå·±å¯«</a></p>


    </main>
  </div>
  <footer>
    <div class="footer-wrapper">
      <p>Made with â¤ï¸ &mdash; Powered by <a href="https://gohugo.io/" target="_blank" rel="external">Hugo</a> and the <a href="https://github.com/bjacquemet/personal-web" target='_blank' rel="external">Personal Web</a> theme.</p>
      <p>@Samina Fu</p>
    </div>
  </footer>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:500,600|Raleway:400,400i,600" rel="stylesheet">
  
  <script type="text/javascript">
    document.querySelector('.mobile-header').addEventListener('click', function () {
      var om = document.querySelector(".overlay-menu");
      if (document.querySelector('.hamburger').classList.contains("cross")) {
        document.querySelector('.hamburger').classList.remove("cross");
        om.style.display = "none";
        om.style.width = "0%";
        om.style.height = "0%";
      }
      else {
        document.querySelector('.hamburger').classList.add("cross");
        om.style.width = "100%";
        om.style.height = "80vh";
        om.style.display = "block";
      }
    });
  </script>
</body>
</html>
